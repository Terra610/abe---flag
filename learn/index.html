<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Learn A.B.E. · Guided Engine Tips</title>
  <style>
    :root { --bg:#0b0d12; --panel:#151923; --ink:#e6e8ee; --muted:#9aa4b2; --accent:#5ddfff; --ok:#2ecc71; --warn:#ffba5c; --bad:#ff6b6b; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    header{padding:1.25rem 1rem;border-bottom:1px solid #1f2430;background:#0f131b;position:sticky;top:0;z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:1.25rem}
    h1{margin:.25rem 0 0;font-size:1.35rem;color:#aee8ff}
    .crumb{font-size:.9rem;color:var(--muted)}
    .grid{display:grid;gap:1.25rem;margin-top:1rem}
    @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:1rem}
    .card h2{font-size:1.05rem;margin:.25rem 0 .75rem;color:#cfefff}
    .sub{color:var(--muted);font-size:.92rem;margin:-.25rem 0 .75rem}
    .row{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
    label{font-size:.87rem;color:#c3c8d4}
    input[type="number"], input[type="range"]{width:120px;background:#0e121a;border:1px solid #2a3040;border-radius:8px;color:var(--ink);padding:.4rem .55rem}
    input[type="range"]{width:200px}
    .pill{display:inline-block;padding:.15rem .55rem;border-radius:999px;font-size:.8rem}
    .ok{background:rgba(46,204,113,.14);border:1px solid rgba(46,204,113,.35);color:#b8ffd2}
    .warn{background:rgba(255,186,92,.12);border:1px solid rgba(255,186,92,.35);color:#ffe3bc}
    .bad{background:rgba(255,107,107,.12);border:1px solid rgba(255,107,107,.35);color:#ffd1d1}
    .kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin:.75rem 0}
    .k{background:#0f141d;border:1px solid #212838;border-radius:10px;padding:.65rem}
    .k .v{font-weight:700;font-size:1.05rem}
    .muted{color:var(--muted)}
    .hint{font-size:.85rem;color:#b6c2d1;margin-top:.5rem}
    code{background:#101520;border:1px solid #242d3f;border-radius:6px;padding:.15rem .35rem}
    footer{margin:2rem 0 1rem;color:#7f8a99;font-size:.85rem}
    .tiny{font-size:.82rem}
    .stack{display:flex;flex-direction:column;gap:.5rem}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="crumb"><a href="/abe---flag/index.html">← Return to Home</a></div>
    <h1>Learn A.B.E. · Guided Engine Tips</h1>
  </div>
</header>

<main class="wrap">

  <p class="sub">
    These quick, hands-on tips show how A.B.E.’s engines compute results, using the same
    numbers cited in the <a href="/abe---flag/doctrine/abe.html">A Decent Proposal + CRRA + Rebuild</a> doctrine.
    Edit the inputs and watch the math update instantly—then jump into the full calculators.
  </p>

  <div class="grid">

    <!-- CIRI TIP -->
    <section class="card" id="ciri">
      <h2>1) CIRI — Constitutional Integrity & Recovery Index</h2>
      <div class="sub">Estimate annual recovery by avoiding unconstitutional cases & jail days.</div>

      <div class="stack">
        <div class="row">
          <label>Cases avoided (per year)</label>
          <input type="number" id="cases" value="1200" min="0" step="100">
          <input type="range" id="casesR" value="1200" min="0" max="5000" step="100">
        </div>
        <div class="row">
          <label>Avg. cost per case (USD)</label>
          <input type="number" id="costCase" value="950" min="0" step="50">
          <input type="range" id="costCaseR" value="950" min="0" max="5000" step="50">
        </div>
        <div class="row">
          <label>Jail days avoided</label>
          <input type="number" id="days" value="3800" min="0" step="50">
          <input type="range" id="daysR" value="3800" min="0" max="20000" step="50">
        </div>
        <div class="row">
          <label>Cost per jail day (USD)</label>
          <input type="number" id="costDay" value="98" min="0" step="2">
          <input type="range" id="costDayR" value="98" min="0" max="350" step="2">
        </div>
      </div>

      <div class="kpi">
        <div class="k"><div class="muted tiny">Case Savings</div><div class="v" id="caseSavings">$0</div></div>
        <div class="k"><div class="muted tiny">Jail Savings</div><div class="v" id="jailSavings">$0</div></div>
        <div class="k"><div class="muted tiny">Total Recovery (annual)</div><div class="v" id="totalRecovery">$0</div></div>
        <div class="k"><div class="muted tiny">ROI per Case Avoided</div><div class="v" id="roiPerCase">$0</div></div>
      </div>

      <div class="hint">
        Tip: These defaults mirror your public demo (e.g., 1,200 cases, $950 per case, 3,800 jail days @ $98/day ⇒
        ~$1.14M recovery). Try doubling <em>cases avoided</em> to feel the sensitivity.
      </div>

      <p class="hint">
        Ready for the full tool? Open the calculator: <a href="/abe---flag/ciri/index.html"><strong>CIRI Calculator</strong></a>
        · Data lives at <code>/ciri/inputs.csv</code>.
        <span id="ciriDataStatus" class="pill warn">checking…</span>
      </p>
    </section>

    <!-- CIBS TIP -->
    <section class="card" id="cibs">
      <h2>2) CIBS — Community Integrity Budget System</h2>
      <div class="sub">Preview how recovered funds auto-allocate into community programs.</div>

      <div class="row">
        <label>Recovered funds to allocate (USD)</label>
        <input type="number" id="pool" value="1140000" min="0" step="10000">
        <input type="range" id="poolR" value="1140000" min="0" max="5000000" step="10000">
      </div>

      <div class="kpi" id="alloc">
        <!-- JS fills with categories based on /cibs/auto_budget.csv if found, else uses sample ratios -->
      </div>

      <div class="hint">
        Tip: If <code>/cibs/auto_budget.csv</code> is present, this preview uses your real categories
        (Community Safety, Youth, Veterans, Digital Access, Legal Defense, Admin…) with their values scaled to the pool.
      </div>

      <p class="hint">
        Full module: <a href="/abe---flag/cibs/index.html"><strong>CIBS Overview</strong></a>
        · Template data: <a href="/abe---flag/cibs/auto_budget.csv">auto_budget.csv</a>
        <span id="cibsDataStatus" class="pill warn">checking…</span>
      </p>
    </section>

    <!-- MACRO TIP -->
    <section class="card" id="macro">
      <h2>3) Macro Cascade — National-Scale Impact</h2>
      <div class="sub">Project GDP and jobs by scaling a “restored community” across many communities.</div>

      <div class="stack">
        <div class="row">
          <label>Recurring funds (annual, USD)</label>
          <input type="number" id="recurring" value="142500000000" min="0" step="50000000">
          <input type="range" id="recurringR" value="142500000000" min="0" max="300000000000" step="50000000">
          <span class="pill ok tiny">Doc range: $142.5B–$262.5B</span>
        </div>
        <div class="row">
          <label>Multiplier (×)</label>
          <input type="number" id="mult" value="1.5" min="1" max="3" step="0.1">
          <input type="range" id="multR" value="1.5" min="1" max="3" step="0.1">
        </div>
        <div class="row">
          <label>Communities</label>
          <input type="number" id="communities" value="100" min="1" step="1">
          <input type="range" id="communitiesR" value="100" min="1" max="10000" step="1">
        </div>
      </div>

      <div class="kpi">
        <div class="k"><div class="muted tiny">GDP Uplift (annual)</div><div class="v" id="gdpUplift">$0</div></div>
        <div class="k"><div class="muted tiny">Per-Community GDP</div><div class="v" id="gdpPer">$0</div></div>
        <div class="k"><div class="muted tiny">Jobs (est.)</div><div class="v" id="jobs">0</div></div>
        <div class="k"><div class="muted tiny">Doc Check</div><div class="v" id="docCheck" class="tiny"></div></div>
      </div>

      <div class="hint">
        Doc cross-check: $142.5B × 1.5 → $213.75B; $262.5B × 1.5 → $393.75B (your Appendix “Recurring Funds & High ROI”).
      </div>

      <p class="hint">
        Full page: <a href="/abe---flag/macro/index.html"><strong>Macroeconomic Cascade</strong></a>
        · JSON model (optional): <code>/macro/ABE_MacroCascadeModel.json</code>
        <span id="macroDataStatus" class="pill warn">checking…</span>
      </p>
    </section>

  </div>

  <footer>
    <div class="tiny">
      Need a link in the top nav? Add <code><a href="/abe---flag/learn/index.html">Learn</a></code> next to CIRI / CIBS / CII / Doctrines / Integration.
      All examples are illustrative and match the numbers cited in your doctrine.
    </div>
  </footer>
</main>

<script>
  // currency helper
  const fmt = n => n.toLocaleString(undefined,{maximumFractionDigits:0});
  const money = n => "$" + fmt(Math.round(n));

  // ---------- CIRI ----------
  const el = id => document.getElementById(id);
  const linkR = (a,b) => { a.addEventListener('input',()=>b.value=a.value); b.addEventListener('input',()=>a.value=b.value); };

  const cases=el('cases'), casesR=el('casesR');
  const costCase=el('costCase'), costCaseR=el('costCaseR');
  const days=el('days'), daysR=el('daysR');
  const costDay=el('costDay'), costDayR=el('costDayR');

  [ [cases,casesR], [costCase,costCaseR], [days,daysR], [costDay,costDayR] ].forEach(([a,b])=>linkR(a,b));

  function renderCIRI(){
    const cs = (+cases.value||0) * (+costCase.value||0);
    const js = (+days.value||0)  * (+costDay.value||0);
    const total = cs + js;
    el('caseSavings').textContent = money(cs);
    el('jailSavings').textContent = money(js);
    el('totalRecovery').textContent = money(total);
    el('roiPerCase').textContent  = money(total / Math.max(+cases.value||1,1));
  }
  ['input','change'].forEach(evt=>{
    [cases,casesR,costCase,costCaseR,days,daysR,costDay,costDayR].forEach(x=>x.addEventListener(evt,renderCIRI));
  });
  renderCIRI();

  // Data presence checks
  fetch('/abe---flag/ciri/inputs.csv',{cache:'no-store'})
    .then(r=> el('ciriDataStatus').textContent = r.ok ? 'data: found' : 'data: not found')
    .then(()=> el('ciriDataStatus').className = 'pill ' + (el('ciriDataStatus').textContent.includes('found')?'ok':'warn'))
    .catch(()=> { el('ciriDataStatus').textContent='data: not found'; el('ciriDataStatus').className='pill warn'; });

  // ---------- CIBS ----------
  const allocBox = el('alloc');
  const pool = el('pool'), poolR = el('poolR'); linkR(pool,poolR);

  let ratios = [
    ['Community Safety', 0.30],
    ['Youth Programs',   0.12],
    ['Veterans',         0.08],
    ['Local Services',   0.20],
    ['Digital Access',   0.10],
    ['Legal Defense',    0.15],
    ['Admin/Steward',    0.05],
  ];
  function drawAlloc(){
    allocBox.innerHTML = '';
    const P = +pool.value || 0;
    ratios.forEach(([name,share])=>{
      const div = document.createElement('div'); div.className='k';
      div.innerHTML = `<div class="muted tiny">${name} (${Math.round(share*100)}%)</div><div class="v">${money(P*share)}</div>`;
      allocBox.appendChild(div);
    });
  }
  ['input','change'].forEach(evt=>[pool,poolR].forEach(x=>x.addEventListener(evt,drawAlloc)));

  // Try to fetch real CSV and derive shares
  fetch('/abe---flag/cibs/auto_budget.csv',{cache:'no-store'})
    .then(async r=>{
      if(!r.ok) throw 0;
      const text = await r.text();
      const lines = text.trim().split(/\r?\n/);
      const rows = lines.slice(1).map(l=>l.split(',')).filter(r=>r.length>=2);
      const totals = rows.reduce((s,[_c,v])=>s+(+v||0),0);
      if(totals>0){
        ratios = rows.map(([c,v])=>[c.trim(), (+v||0)/totals]);
        el('cibsDataStatus').textContent='data: found'; el('cibsDataStatus').className='pill ok';
      } else { throw 0; }
    })
    .catch(()=>{ el('cibsDataStatus').textContent='data: not found (using sample)'; el('cibsDataStatus').className='pill warn'; })
    .finally(drawAlloc);

  // ---------- Macro ----------
  const recurring = el('recurring'), recurringR = el('recurringR'); linkR(recurring,recurringR);
  const mult = el('mult'), multR = el('multR'); linkR(mult,multR);
  const communities = el('communities'), communitiesR = el('communitiesR'); linkR(communities,communitiesR);

  function renderMacro(){
    const R = +recurring.value || 0;
    const M = +mult.value || 1;
    const C = +communities.value || 1;
    const gdp = R * M;
    const per = gdp / Math.max(C,1);
    el('gdpUplift').textContent = money(gdp);
    el('gdpPer').textContent    = money(per);
    // very simple jobs proxy: $80k per job-year (tweak later if you prefer)
    el('jobs').textContent      = fmt(Math.round(gdp / 80000));
    const low = 142500000000*1.5, high = 262500000000*1.5;
    const ok = gdp>=low && gdp<=high ? 'ok':'warn';
    el('docCheck').innerHTML = `<span class="pill ${ok}">${money(low)} – ${money(high)} (doc range)</span>`;
  }
  ['input','change'].forEach(evt=>[recurring,recurringR,mult,multR,communities,communitiesR].forEach(x=>x.addEventListener(evt,renderMacro)));
  renderMacro();

  // presence of JSON model (optional)
  fetch('/abe---flag/macro/ABE_MacroCascadeModel.json',{cache:'no-store'})
    .then(r=>{ el('macroDataStatus').textContent = r.ok?'model: found':'model: not found'; el('macroDataStatus').className = 'pill ' + (r.ok?'ok':'warn'); })
    .catch(()=>{ el('macroDataStatus').textContent = 'model: not found'; el('macroDataStatus').className='pill warn'; });
</script>
</body>
  </html>
