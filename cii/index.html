<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CII ‚Äî Citizen Impact Index</title>
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0b0d12; --panel:#12161d; --panel2:#171c24;
      --border:rgba(255,255,255,.08);
      --text:#e0e0e0; --muted:#9aa4b2;
      --brand:#5ddfff; --accent:#ffa559;
      --good:#33d17a; --warn:#ffd166; --bad:#f25f5c;
      --shadow:0 8px 30px rgba(0,0,0,.35);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.55}
    header{position:sticky;top:0;background:linear-gradient(90deg,#0e131b,#141a22);border-bottom:1px solid var(--border);padding:16px 22px;z-index:2}
    header h1{margin:0 0 4px 0;font-size:1.35rem;color:var(--brand)}
    header p{margin:0;color:var(--muted);font-size:.95rem}
    main{max-width:1100px;margin:24px auto 72px auto;padding:0 16px}
    .crumbs{margin:6px 0 0 0;font-size:.85rem}
    .crumbs a{color:#80bfff;text-decoration:none}
    .crumbs a:hover{text-decoration:underline}
    .grid{display:grid;gap:16px}
    .kpis{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .cards{grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card.hi{background:var(--panel2)}
    .card .inner{padding:16px 18px}
    h2{margin:0 0 8px 0;font-size:1.15rem;color:#bfe9ff}
    .muted{color:var(--muted)}
    .kpi {display:flex;flex-direction:column;gap:6px}
    .kpi .label{font-size:.9rem;color:var(--muted)}
    .kpi .value{font-weight:700;font-size:1.35rem}
    .value.bad{color:var(--bad)} .value.good{color:var(--good)}
    .value.mid{color:var(--accent)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;background:#0f141c;border:1px solid var(--border);color:#cfe9ff;padding:8px 12px;border-radius:10px;text-decoration:none}
    .btn:hover{border-color:#2b3a4d}
    code, .chip{background:#0d131a;border:1px solid var(--border);border-radius:8px;padding:2px 6px;font-size:.85rem;color:#cde7ff}
    canvas {width:100% !important; height:320px !important}
    .list a{color:#80bfff;text-decoration:none}
    .list a:hover{text-decoration:underline}
    footer{margin:48px 0 32px 0;text-align:center;color:var(--muted);font-size:.9rem}
    .note{font-size:.85rem;color:var(--muted)}
  </style>
</head>
<body>

<header>
  <div class="crumbs">‚Üê <a href="../index.html">Return to Home</a></div>
  <h1>üîé CII ‚Äî Citizen Impact Index</h1>
  <p>Quantifies integrity of funding and the real-world benefits of lawful alignment. Computes savings, GDP uplift,
     and verifies evidence linking CIRI ‚Üí CIBS.</p>
</header>

<main>

  <!-- STATUS / LINKS -->
  <section class="grid cards" aria-label="Status">
    <div class="card hi">
      <div class="inner">
        <h2>Status</h2>
        <div class="row">
          <span class="chip">Spec: <a href="#" class="list">/cii/model.md</a> (TBD)</span>
          <span class="chip">Data: <code>/cii/data/</code></span>
          <span class="chip">Theme: ABE Patch Active</span>
        </div>
        <p class="note" style="margin-top:10px">If CSV files are present in <code>/cii/data/</code>, this page will auto-load them.
          Otherwise it falls back to safe sample data so the board can still see the story live.</p>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <h2>Jump to</h2>
        <div class="row">
          <a class="btn" href="../ciri/index.html">CIRI (calc)</a>
          <a class="btn" href="../cibs/index.html">CIBS (budget)</a>
          <a class="btn" href="../system/index.html">System Map</a>
          <a class="btn" href="../integration/index.html">Integration Layer</a>
          <a class="btn" href="../doctrine/index.html">Doctrines</a>
        </div>
      </div>
    </div>
  </section>

  <!-- KPIs -->
  <section class="grid kpis" aria-label="KPIs">
    <div class="card">
      <div class="inner kpi">
        <span class="label">Estimated Misused Grants (annual)</span>
        <span id="kpi-misused" class="value bad">‚Äî</span>
        <span class="note">From funding-fraud summary (Title 23/49 categories).</span>
      </div>
    </div>
    <div class="card">
      <div class="inner kpi">
        <span class="label">Direct Savings (annual)</span>
        <span id="kpi-savings" class="value good">‚Äî</span>
        <span class="note">Conservative savings when misuse is corrected.</span>
      </div>
    </div>
    <div class="card">
      <div class="inner kpi">
        <span class="label">Projected GDP Uplift</span>
        <span id="kpi-gdp" class="value mid">‚Äî</span>
        <span class="note">Uses 1.5√ó multiplier on reallocated funds (ABE macro model).</span>
      </div>
    </div>
  </section>

  <!-- CHARTS -->
  <section class="grid cards" aria-label="Charts">
    <div class="card">
      <div class="inner">
        <h2>Funding Misuse by Program</h2>
        <canvas id="chartMisuse"></canvas>
        <p class="note">Data source: <code>FMCSR_Funding_Fraud_Summary.csv</code> (program,misused_usd).</p>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <h2>Enforcement vs Community Investment (ROI)</h2>
        <canvas id="chartROI"></canvas>
        <p class="note">Compares ‚Äúenforcement spend‚Äù vs ‚Äúcommunity repair‚Äù outcomes (crime, jobs, GDP contribution).</p>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <h2>Historical Trend ‚Äî Integrity of Funding (1962 ‚Üí Today)</h2>
        <canvas id="chartHistory"></canvas>
        <p class="note">Optional source: <code>historical_funding.csv</code> (year,enforcement,community).</p>
      </div>
    </div>
  </section>

  <!-- EVIDENCE -->
  <section class="card" style="margin-top:18px">
    <div class="inner">
      <h2>Evidence & References</h2>
      <ul class="list">
        <!-- Adjust these links to wherever you commit the PDFs/HTML -->
        <li><a href="../doctrine/abe.html">A Decent Proposal: A.B.E. (full)</a></li>
        <li><a href="../doctrine/constitutional-fidelity.html">Constitutional Fidelity (full)</a></li>
        <li><a href="../doctrine/void-ab-initio.html">Void ab Initio (full)</a></li>
        <li><a href="../evidence/FHWA-FMCSA_Memorandum_Title_23_and_Title_49.pdf">FHWA‚ÄìFMCSA Memorandum (Title 23/49)</a></li>
        <li><a href="../evidence/46M_Stops_NonCDL.pdf">46M Stops ‚Äî Non-CDL Impact</a></li>
        <li><a href="../evidence/ABE_Table2_Funding_Misuse_Adjusted.pdf">ABE Table 2 ‚Äî Funding Misuse (Adjusted)</a></li>
        <li><a href="../evidence/Comparative_Analysis_Public_vs_Community_Safety.pdf">Comparative Analysis: Public vs Community Safety</a></li>
        <li><a href="../evidence/US_Traffic_Stops_Commerce_Disruption.html">Traffic Stops & Commerce Disruption (interactive)</a></li>
      </ul>
      <p class="note" style="margin-top:10px">
        Put your PDFs/HTML in <code>/evidence/</code> (or update the links). If a file isn‚Äôt present yet, the link will 404 until you commit it.
      </p>
    </div>
  </section>

  <footer>
    A.B.E. ¬∑ Citizen Impact Index (CII) ¬∑ CC BY 4.0 ¬∑ Integrity only.
  </footer>
</main>

<!-- ========= Fallback embedded data (keeps the page working until your CSVs are committed) ========= -->
<script id="fraudCsv" type="text/plain">
program,misused_usd
Title 23 Safety Grants,42000000000
Title 49 FMCSA (CMV-focused),33000000000
Traffic Enforcement Overtime,9000000000
DUI Checkpoint Programs,4500000000
Backdoor Equipment Mandates,2800000000
Other Transfers / Admin,1900000000
</script>

<script id="roiJson" type="application/json">
{
  "labels":["Status Quo Enforcement","Community Investment"],
  "crime_reduction":[2, 22],
  "jobs_created":[0.2, 3.0],
  "gdp_contribution_usd":[12, 95]
}
</script>

<script id="historyCsv" type="text/plain">
year,enforcement,community
1965,12,24
1980,26,21
1995,44,18
2008,58,16
2016,62,14
2020,70,13
2024,73,13
2025,74,15
</script>

<!-- ========= Loader & Charts ========= -->
<script>
/* ---------- CONFIG: where to look for real data if present ----------

1) If you later commit CSVs to your repo, drop them here and the page will use them:

   /cii/data/FMCSR_Funding_Fraud_Summary.csv
   /cii/data/historical_funding.csv
   /cii/data/roi.json

2) Otherwise the embedded fallbacks above are used so nothing breaks in demos.
--------------------------------------------------------------------- */

const PATHS = {
  fraudCsv:  './data/FMCSR_Funding_Fraud_Summary.csv',
  historyCsv:'./data/historical_funding.csv',
  roiJson:   './data/roi.json'
};

// Simple CSV parser (no deps)
function parseCSV(text){
  const rows = text.trim().split(/\r?\n/).map(r=>r.split(','));
  const [hdr, ...body] = rows;
  return body.map(r => Object.fromEntries(r.map((v,i)=>[hdr[i], v])));
}

async function fetchOrFallback(url, fallbackId, type='csv'){
  try{
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('not found');
    if(type==='csv')  return parseCSV(await res.text());
    if(type==='json') return await res.json();
    return await res.text();
  }catch(e){
    if(type==='csv')  return parseCSV(document.getElementById(fallbackId).textContent);
    if(type==='json') return JSON.parse(document.getElementById(fallbackId).textContent);
    return document.getElementById(fallbackId).textContent;
  }
}

function usd(n){ return Number(n).toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); }

// Build charts + KPIs
(async function(){
  const fraud = await fetchOrFallback(PATHS.fraudCsv, 'fraudCsv','csv');
  const roi   = await fetchOrFallback(PATHS.roiJson, 'roiJson','json');
  const hist  = await fetchOrFallback(PATHS.historyCsv,'historyCsv','csv');

  // KPIs
  const totalMisused = fraud.reduce((s,r)=>s + Number(r.misused_usd||0), 0);
  const directSavings = totalMisused * 0.38; // conservative 38% immediate savings
  const gdpUplift     = (totalMisused * 0.5) * 1.5; // half reallocated √ó 1.5√ó multiplier

  document.getElementById('kpi-misused').textContent = usd(totalMisused);
  document.getElementById('kpi-savings').textContent = usd(directSavings);
  document.getElementById('kpi-gdp').textContent     = usd(gdpUplift);

  // Chart 1: Funding Misuse by Program
  new Chart(document.getElementById('chartMisuse'), {
    type:'bar',
    data:{
      labels: fraud.map(r=>r.program),
      datasets:[{label:'Misused (USD)', data: fraud.map(r=>Number(r.misused_usd||0))}]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}, tooltip:{callbacks:{
        label:(ctx)=> usd(ctx.parsed.y)
      }}},
      scales:{y:{ticks:{callback:(v)=>usd(v)}}}
    }
  });

  // Chart 2: ROI comparison
  new Chart(document.getElementById('chartROI'),{
    type:'radar',
    data:{
      labels:['Crime reduction (%)','Jobs created (per $B)','GDP contribution ($B)'],
      datasets:[
        {
          label: roi.labels[0],
          data:[roi.crime_reduction[0], roi.jobs_created[0], roi.gdp_contribution_usd[0]]
        },
        {
          label: roi.labels[1],
          data:[roi.crime_reduction[1], roi.jobs_created[1], roi.gdp_contribution_usd[1]]
        }
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'top'}}
    }
  });

  // Chart 3: Historical integrity trend
  new Chart(document.getElementById('chartHistory'),{
    type:'line',
    data:{
      labels: hist.map(r=>r.year),
      datasets:[
        {label:'Enforcement-centric (%)', data: hist.map(r=>Number(r.enforcement))},
        {label:'Community-centric (%)',  data: hist.map(r=>Number(r.community))}
      ]
    },
    options:{
      responsive:true,
      scales:{y:{min:0,max:100,ticks:{callback:(v)=>v+'%'}}}
    }
  });
})();
</script>

</body>
</html>
