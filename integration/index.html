<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Integration — SHA-256 Audit Graph | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css"/>
  <style>
    :root{
      --int-bg:#05060b;
      --int-panel:#111522;
      --int-panel-soft:#161a25;
      --int-ink:#edf2ff;
      --int-muted:#9fb3c8;
      --int-accent:#5ddfff;
      --int-warn:#ffba5c;
      --int-bad:#ff8585;
      --int-ok:#4bd28f;
      --int-border:rgba(255,255,255,.08);
    }

    body.abe-page{
      background:radial-gradient(circle at top,#111827 0,#05060b 55%,#020309 100%);
      color:var(--int-ink);
    }

    .int-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.5rem 1rem 3rem;
    }

    .int-header h1{
      margin:0 0 .25rem;
      font-size:1.9rem;
    }

    .int-header .tagline{
      max-width:720px;
      color:var(--int-muted);
      font-size:.98rem;
    }

    .chip-row{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      margin-top:.75rem;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.3rem .8rem;
      border-radius:999px;
      border:1px solid var(--int-border);
      font-size:.86rem;
      text-decoration:none;
      color:var(--int-ink);
      background:#050712;
    }
    .chip:hover{border-color:var(--int-accent);}
    .chip-alt{
      border-color:var(--int-accent);
    }

    .card{
      background:linear-gradient(135deg,var(--int-panel),#0b101a);
      border-radius:14px;
      border:1px solid var(--int-border);
      padding:1rem 1.2rem 1.2rem;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      margin-bottom:1rem;
    }

    h2{
      margin:.1rem 0 .5rem;
      font-size:1.1rem;
    }

    p,li{
      font-size:.9rem;
      color:var(--int-muted);
    }

    code{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:.84rem;
      background:#050712;
      padding:.08rem .3rem;
      border-radius:4px;
    }

    /* Last check + legend */
    .status-row{
      display:flex;
      flex-wrap:wrap;
      gap:1rem;
      align-items:center;
      justify-content:space-between;
    }
    .status-main{
      font-size:.95rem;
    }
    .status-main strong{
      font-size:1.05rem;
    }
    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:.4rem .75rem;
      font-size:.83rem;
      color:var(--int-muted);
    }
    .legend span{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
    }
    .legend-dot{
      width:9px;
      height:9px;
      border-radius:50%;
      display:inline-block;
    }
    .lg-ok{background:var(--int-ok);}
    .lg-warn{background:var(--int-warn);}
    .lg-bad{background:var(--int-bad);}

    /* Graph panel */
    .graph-wrap{
      border-radius:14px;
      background:#050712;
      border:1px solid var(--int-border);
      padding:.5rem;
      height:420px;
      overflow:hidden;
    }
    #integration-graph{
      width:100%;
      height:100%;
    }

    /* Local engine footprints */
    .card-local{
      margin-top:.3rem;
    }
    .card-local .muted{
      font-size:.9rem;
    }
    .local-grid{
      display:grid;
      gap:.7rem;
      margin-top:.6rem;
    }
    @media(min-width:800px){
      .local-grid{
        grid-template-columns:repeat(3,minmax(0,1fr));
      }
    }
    .local-item{
      background:#050712;
      border-radius:10px;
      border:1px solid var(--int-border);
      padding:.55rem .7rem .6rem;
    }
    .local-title{
      font-size:.88rem;
      font-weight:600;
      margin:0 0 .2rem;
    }
    .local-meta{
      font-size:.8rem;
      color:var(--int-muted);
      margin-top:.15rem;
    }
    .local-pill{
      display:inline-flex;
      align-items:center;
      padding:.1rem .55rem;
      border-radius:999px;
      border:1px solid var(--int-border);
      font-size:.78rem;
      margin-top:.1rem;
      color:var(--int-muted);
    }
    .local-pill.ok{
      border-color:var(--int-ok);
      color:var(--int-ok);
    }
    .local-pill.miss{
      border-color:var(--int-bad);
      color:var(--int-bad);
    }
    .local-pill.warn{
      border-color:var(--int-warn);
      color:var(--int-warn);
    }

    footer.abe-footer{
      margin-top:2.5rem;
      text-align:center;
      color:var(--int-muted);
      font-size:.85rem;
    }
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="int-wrap int-header">
    <a href="index.html" class="chip">← A.B.E. Home</a>
    <h1>Integration — SHA-256 Audit Graph</h1>
    <p class="tagline">
      Client-side integrity for the whole engine. No logins, no servers — just hashes, files, and a transparent map.
    </p>
    <nav class="chip-row">
      <a class="chip" href="intake/index.html">Intake</a>
      <a class="chip" href="cda/index.html">CDA</a>
      <a class="chip" href="ciri/index.html">CIRI</a>
      <a class="chip" href="cibs/index.html">CIBS</a>
      <a class="chip" href="cii/index.html">CII</a>
      <a class="chip" href="doctrine/index.html">Doctrines</a>
      <a class="chip chip-alt" href="system/index.html">System Map</a>
    </nav>
  </div>
</header>

<main class="abe-main">
  <div class="int-wrap">

    <!-- Status + graph -->
    <section class="card">
      <div class="status-row">
        <div class="status-main">
          <div>Last Check</div>
          <div id="last-check"><strong>—</strong></div>
        </div>
        <div class="legend">
          <span><span class="legend-dot lg-ok"></span>verified</span>
          <span><span class="legend-dot lg-warn"></span>partial / unknown</span>
          <span><span class="legend-dot lg-bad"></span>mismatch</span>
          <span>· link color = upstream verified</span>
        </div>
      </div>

      <div class="graph-wrap" style="margin-top:.8rem;">
        <!-- viewer.js will draw into this SVG -->
        <svg id="integration-graph"></svg>
      </div>
    </section>

    <!-- Local engine footprints -->
    <section class="card card-local">
      <h2>Local Engine Footprints (this device only)</h2>
      <p class="muted">
        This shows what <strong>this browser</strong> currently holds from A.B.E. runs. Data lives only in
        <code>localStorage</code> on this device — nothing here is uploaded or logged.
      </p>

      <div class="local-grid">
        <!-- Intake -->
        <div class="local-item">
          <div class="local-title">Intake artifact</div>
          <div id="local-intake-status" class="local-pill">checking…</div>
          <div id="local-intake-meta" class="local-meta">
            Looking for <code>abe_intake_artifact</code>…
          </div>
        </div>

        <!-- CIRI -->
        <div class="local-item">
          <div class="local-title">CIRI scenario</div>
          <div id="local-ciri-status" class="local-pill">checking…</div>
          <div id="local-ciri-meta" class="local-meta">
            Looking for <code>ABE_CIRI_SCENARIO_V2</code>…
          </div>
        </div>

        <!-- CDA -->
        <div class="local-item">
          <div class="local-title">CDA divergence scenario</div>
          <div id="local-cda-status" class="local-pill">checking…</div>
          <div id="local-cda-meta" class="local-meta">
            Looking for <code>ABE_CDA_SCENARIO_V1</code>…
          </div>
        </div>
      </div>
    </section>

    <!-- Explanation -->
    <section class="card">
      <h2>What You’re Seeing</h2>
      <ul>
        <li><strong>Rectangles</strong> are modules (Intake, CDA, CIRI, CFF, CCRI, CIBS, CII, Macro…).
          Stroke color reflects integrity based on <code>system/ledger.json</code>.</li>
        <li><strong>Arrows</strong> show the canonical data flow defined in <code>system/map.json</code>
          (for example: Intake → CDA → CIRI → CIBS → CII).</li>
        <li>If a tracked file is missing or can’t be fetched, its node shows as
          <span style="color:var(--int-warn);font-weight:600;">partial/unknown</span>.</li>
        <li>If a file’s live SHA-256 doesn’t match the ledger, the node shows as
          <span style="color:var(--int-bad);font-weight:600;">mismatch</span>.</li>
        <li>The “Local Engine Footprints” section above is separate: it only looks at
          what this browser has stored from your own runs (Intake, CIRI, CDA).</li>
      </ul>
    </section>

    <!-- How-to -->
    <section class="card">
      <h2>How to Verify Locally</h2>
      <ol>
        <li>Open <code>system/ledger.json</code> in this repo. Each entry lists a file path and its
          canonical SHA-256 hash.</li>
        <li>Download any file you care about — for example
          <code>cda/schema.json</code>, <code>ciri/model.json</code>, or a doctrine PDF.</li>
        <li>On your own machine, run a SHA-256 tool (command line or GUI) on that file
          and compare the hash to the ledger:</li>
      </ol>
<pre><code>sha256sum cda/schema.json
# or
shasum -a 256 cda/schema.json
</code></pre>
      <ol start="4">
        <li>If the hash matches, the file is verified. If not, you’ve found tampering or an unlogged edit.</li>
        <li>Any time you intentionally update a tracked file, update its hash in
          <code>system/ledger.json</code> so future checks stay honest.</li>
      </ol>
      <p>
        A.B.E. never phones home. All integrity checks happen in your browser, against files you can see, hash,
        and print. That’s the whole point.
      </p>
    </section>

  </div>
</main>

<footer class="abe-footer">
  <p>
    CC BY-NC 4.0 · DOI <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a> ·
    Integrity only — never for sale.
  </p>
</footer>

<!-- Existing graph renderer (already in your repo) -->
<script src="integration/viewer.js"></script>

<!-- New: local engine footprints (Intake, CIRI, CDA) -->
<script src="integration/local.js"></script>

</body>
</html>
