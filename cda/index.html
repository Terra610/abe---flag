<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CDA ‚Äî Constitutional Divergence Analyzer | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css">
  <style>
    :root{
      --abe-bg:#05060b;
      --abe-panel:#10131c;
      --abe-panel-soft:#161a25;
      --abe-ink:#edf2ff;
      --abe-muted:#9fb3c8;
      --abe-accent:#5ddfff;
      --abe-pop:#fff750;
      --abe-border:rgba(255,255,255,.08);
    }
    body.abe-page{
      background:radial-gradient(circle at top,#111827 0,#05060b 55%,#020309 100%);
      color:var(--abe-ink);
    }
    .cda-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.5rem 1rem 3rem;
    }
    .cda-header h1{
      margin:0 0 .25rem;
      font-size:1.9rem;
    }
    .cda-header .tagline{
      max-width:720px;
      color:var(--abe-muted);
      font-size:.98rem;
    }
    .chip-row{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      margin-top:.75rem;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.35rem .9rem;
      border-radius:999px;
      border:1px solid var(--abe-border);
      font-size:.85rem;
      text-decoration:none;
      color:var(--abe-ink);
      background:#050712;
    }
    .chip:hover{border-color:var(--abe-accent);}
    .chip-alt{
      border-color:var(--abe-accent);
    }

    .cda-grid{
      display:grid;
      gap:1.25rem;
      margin-top:1.4rem;
    }
    @media(min-width:900px){
      .cda-grid{
        grid-template-columns:3fr 2.3fr;
      }
    }

    .card-cda{
      background:linear-gradient(135deg,var(--abe-panel),#0b101a);
      border-radius:14px;
      border:1px solid var(--abe-border);
      padding:1rem 1.1rem 1.25rem;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
    }
    .card-cda h2{
      margin:.1rem 0 .4rem;
      font-size:1.15rem;
    }
    .card-cda h3{
      margin:.4rem 0 .35rem;
      font-size:1rem;
    }
    .sub{
      color:var(--abe-muted);
      font-size:.9rem;
    }

    label{
      display:block;
      font-size:.88rem;
      color:var(--abe-muted);
      margin:.55rem 0 .2rem;
    }
    input[type="text"],
    textarea,
    select{
      width:100%;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--abe-border);
      padding:.45rem .6rem;
      color:var(--abe-ink);
      font-size:.9rem;
    }
    textarea{
      min-height:70px;
      resize:vertical;
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.84rem;
    }
    select{
      border-radius:999px;
    }

    .two-col{
      display:grid;
      gap:.6rem;
    }
    @media(min-width:600px){
      .two-col{
        grid-template-columns:1.1fr 1fr;
      }
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:.1rem .6rem;
      border-radius:999px;
      border:1px solid var(--abe-border);
      font-size:.78rem;
      color:var(--abe-muted);
    }
    .pill-law{border-color:#5ddfff;}
    .pill-local{border-color:#4bd28f;color:#4bd28f;}

    .flags-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:.3rem .7rem;
      margin-top:.3rem;
    }
    .flag-item{
      display:flex;
      align-items:flex-start;
      gap:.3rem;
      font-size:.86rem;
      color:var(--abe-muted);
    }
    .flag-item input[type="checkbox"]{
      margin-top:.12rem;
    }
    .flag-item strong{
      color:var(--abe-ink);
      font-weight:500;
    }

    .btn-run{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:.9rem;
      padding:.5rem 1.1rem;
      border-radius:999px;
      border:1px solid var(--abe-pop);
      background:transparent;
      color:var(--abe-ink);
      font-size:.9rem;
      cursor:pointer;
      gap:.35rem;
      box-shadow:0 0 0 1px rgba(0,0,0,.5);
    }
    .btn-run:hover{
      box-shadow:0 0 0 1px rgba(255,247,80,.4),0 0 18px rgba(255,247,80,.25);
    }

    .status-line{
      margin-top:.5rem;
      font-size:.85rem;
      color:var(--abe-muted);
    }
    .status-ok{color:#4bd28f;}
    .status-warn{color:#ffba5c;}
    .status-err{color:#ff8585;}

    pre{
      margin:.35rem 0 .6rem;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--abe-border);
      padding:.6rem .7rem;
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.82rem;
      color:var(--abe-ink);
      max-height:260px;
      overflow:auto;
      white-space:pre-wrap;
    }

    .score-big{
      font-size:1.6rem;
      font-weight:700;
    }
    .score-label{
      font-size:.85rem;
      color:var(--abe-muted);
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      margin-top:.3rem;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.4rem .85rem;
      border-radius:999px;
      border:1px solid var(--abe-border);
      background:#050712;
      color:var(--abe-ink);
      font-size:.85rem;
      cursor:pointer;
      text-decoration:none;
    }
    .btn:hover{border-color:var(--abe-accent);}
    .btn:disabled{
      opacity:.5;
      cursor:default;
    }

    .small-note{
      font-size:.8rem;
      color:var(--abe-muted);
    }

    footer.abe-footer{
      margin-top:2.5rem;
      text-align:center;
      font-size:.85rem;
      color:var(--abe-muted);
    }
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="cda-wrap cda-header">
    <a href="index.html" class="chip">‚Üê A.B.E. Home</a>
    <h1>CDA ‚Äî Constitutional Divergence Analyzer</h1>
    <p class="tagline">
      Turn a statute, funding rule, or enforcement practice into concrete divergence flags
      and a 0‚Äì1 score that CIRI, CFF, and Macro can consume.
    </p>
    <div class="chip-row">
      <span class="chip chip-alt">No servers ¬∑ all in this browser</span>
      <span id="law-bridge-pill" class="chip pill-law" style="display:none;">
        Linked to Law Viewer node
      </span>
      <a class="chip" href="law/index.html">Law Corpus</a>
      <a class="chip" href="intake/index.html">Intake</a>
      <a class="chip" href="cff/index.html">CFF</a>
      <a class="chip" href="integration/index.html">Integration</a>
    </div>
  </div>
</header>

<main class="abe-main">
  <div class="cda-wrap cda-grid">

    <!-- LEFT: inputs -->
    <section class="card-cda">
      <h2>Step 1 ‚Äî Describe the rule or practice</h2>
      <p class="sub">
        You can type this in yourself, or open a node in the <strong>Law</strong> viewer and let CDA pre-fill
        the statute and citations from <code>ABE_LAW_TO_CDA</code>.
      </p>

      <div class="two-col">
        <div>
          <label for="statute-name">Name of statute / policy / practice</label>
          <input id="statute-name" type="text" placeholder="Example: Iowa DPS use of FMCSRs on non-commercial drivers"/>
        </div>
        <div>
          <label for="jurisdiction">Jurisdiction (optional)</label>
          <input id="jurisdiction" type="text" placeholder="e.g., Iowa, Federal, Multistate"/>
        </div>
      </div>

      <div class="two-col">
        <div>
          <label for="level">Level</label>
          <select id="level">
            <option value="state" selected>State / local</option>
            <option value="federal">Federal</option>
          </select>
        </div>
        <div>
          <label for="population">Population impacted</label>
          <select id="population">
            <option value="non_commercial">Non-commercial individuals</option>
            <option value="commercial">Commercial / DOT-regulated</option>
            <option value="mixed">Mixed / unclear</option>
          </select>
        </div>
      </div>

      <label for="citations">Citations (optional)</label>
      <textarea id="citations" placeholder="49 U.S.C. ¬ß 31136; 49 CFR 390.3; Iowa Code 80.9; etc."></textarea>

      <label for="funding-streams">Funding streams (optional)</label>
      <textarea id="funding-streams" placeholder="MCSAP; Highway Safety grants; State DOT funds; etc."></textarea>

      <h3>Step 2 ‚Äî Set divergence flags</h3>
      <p class="sub">
        Check everything that is true for this scenario. CDA will compute a 0‚Äì1 score:
        <strong>0 = fully aligned</strong>, <strong>1 = maximally divergent</strong>.
      </p>

      <div class="flags-grid">
        <label class="flag-item">
          <input type="checkbox" id="flag-scope-noncommercial"/>
          <span><strong>Scope: non-commercial treated as commercial</strong><br>Private citizens are treated as if they were DOT-regulated carriers.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-preemption-conflict"/>
          <span><strong>Preemption conflict</strong><br>State rule conflicts with, or expands beyond, federal commercial scope.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-preemption-field"/>
          <span><strong>Field preemption</strong><br>State is legislating in an area already occupied by Congress.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-ultra-vires"/>
          <span><strong>Ultra vires enforcement</strong><br>Agency is acting beyond what its statutes actually authorize.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-mcsap-off-mission"/>
          <span><strong>MCSAP off-mission</strong><br>Commercial enforcement funding used on non-commercial activity.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-funding-conditions-ignored"/>
          <span><strong>Funding conditions ignored</strong><br>Practice contradicts federal funding conditions or FMCSR adoption rules.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-funding-nontransparent"/>
          <span><strong>Funding non-transparent</strong><br>People affected cannot easily see what funding is being used.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-right-to-travel"/>
          <span><strong>Right to travel burdened</strong><br>Non-commercial movement is restricted or criminalized.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-due-process"/>
          <span><strong>Due process defects</strong><br>No clear notice, hearing, or appeal before rights are taken.</span>
        </label>
        <label class="flag-item">
          <input type="checkbox" id="flag-selective"/>
          <span><strong>Selective application</strong><br>Rule is applied arbitrarily or only to certain groups.</span>
        </label>
      </div>

      <button id="btn-generate" class="btn-run">
        <span>‚öñÔ∏è Generate CDA scenario</span>
      </button>
      <div id="cda-status" class="status-line">Status: waiting for inputs‚Ä¶</div>
    </section>

    <!-- RIGHT: outputs -->
    <section class="card-cda">
      <h2>Step 3 ‚Äî Review result & export</h2>

      <div>
        <div class="score-label">Divergence score (0‚Äì1)</div>
        <div id="score-value" class="score-big">‚Äî</div>
      </div>

      <h3>Structured JSON</h3>
      <pre id="cda-json">{
  "version": "1.0",
  "module": "CDA",
  "message": "Click ‚ÄúGenerate CDA scenario‚Äù to see output here."
}</pre>

      <h3>Plain-language summary</h3>
      <pre id="cda-summary">Summary will appear here after you generate a scenario‚Ä¶</pre>

      <div class="btn-row">
        <button id="btn-download" class="btn" disabled>‚¨á Download cda_scenario.json</button>
        <button id="btn-copy-hash" class="btn" disabled>üîó Copy SHA-256 hash</button>
      </div>

      <p class="small-note">
        CDA runs entirely in this browser tab. When you generate a scenario, it is also stored as
        <code>ABE_CDA_SCENARIO_V1</code> in <em>localStorage</em> so other A.B.E. views on this device
        (like Integration) can see it.
      </p>
    </section>

  </div>
</main>

<footer class="abe-footer">
  CC BY-NC 4.0 ¬∑ Constitutional Divergence Analyzer ¬∑ Integrity only ‚Äî never for sale.
</footer>

<script src="cda/cda.js"></script>
</body>
</html>
