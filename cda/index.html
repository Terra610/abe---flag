<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CDA — Constitutional Divergence Analyzer | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css">
  <style>
    .cda-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.5rem 1rem 3rem;
    }
    .cda-header h1{
      margin:0 0 .25rem;
      font-size:1.9rem;
    }
    .cda-header .tagline{
      max-width:720px;
      color:var(--muted);
      font-size:.98rem;
    }
    .cda-grid{
      display:grid;
      gap:1.1rem;
    }
    @media(min-width:900px){
      .cda-grid{
        grid-template-columns:1.4fr 1.6fr;
      }
    }
    .cda-card{
      background:var(--panel);
      border-radius:14px;
      border:1px solid var(--line);
      padding:1rem 1.1rem 1.2rem;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      min-height:0;
    }
    .cda-card h2{
      margin:.1rem 0 .4rem;
      font-size:1.15rem;
    }
    .cda-card h3{
      margin:.35rem 0 .3rem;
      font-size:1rem;
    }
    .cda-sub{
      color:var(--muted);
      font-size:.9rem;
    }
    label{
      display:block;
      font-size:.88rem;
      color:var(--muted);
      margin:.55rem 0 .2rem;
    }
    input[type="text"],
    select,
    textarea{
      width:100%;
      background:#050712;
      border-radius:9px;
      border:1px solid var(--line);
      padding:.45rem .6rem;
      color:var(--ink);
      font-size:.88rem;
    }
    textarea{
      min-height:90px;
      resize:vertical;
    }
    .cda-row{
      display:flex;
      gap:.6rem;
      flex-wrap:wrap;
    }
    .cda-row > div{
      flex:1 1 140px;
    }
    .cda-chips{
      display:flex;
      flex-wrap:wrap;
      gap:.35rem;
      margin-top:.35rem;
      font-size:.82rem;
    }
    .cda-chip{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:.18rem .55rem;
      border-radius:999px;
      border:1px solid var(--line);
      cursor:pointer;
      user-select:none;
    }
    .cda-chip input{
      margin:0;
    }
    .cda-chip-main{
      border-color:#5ddfff;
    }
    .cda-chip-rights{
      border-color:#ffba5c;
    }
    .cda-chip-fund{
      border-color:#b58bff;
    }
    .cda-chip-scope{
      border-color:#4bd28f;
    }
    .cda-score-badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.18rem .6rem;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:.82rem;
      margin-top:.4rem;
    }
    .cda-score-badge span{
      font-weight:600;
    }
    .cda-score-high span{color:#ff8585;}
    .cda-score-mid span{color:#ffba5c;}
    .cda-score-low span{color:#4bd28f;}
    .btn-run{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:.8rem;
      padding:.45rem 1.05rem;
      border-radius:999px;
      border:1px solid var(--accent);
      background:#050712;
      color:var(--ink);
      font-size:.9rem;
      cursor:pointer;
      gap:.4rem;
    }
    .btn-run:hover{
      box-shadow:0 0 0 1px rgba(93,223,255,.36),0 0 18px rgba(93,223,255,.25);
    }
    .btn-download{
      margin-top:.5rem;
      padding:.38rem .9rem;
      border-radius:999px;
      border:1px solid var(--line);
      background:#050712;
      color:var(--ink);
      font-size:.85rem;
      cursor:pointer;
    }
    .btn-download:disabled{
      opacity:.5;
      cursor:default;
    }
    .cda-status{
      margin-top:.6rem;
      font-size:.84rem;
      color:var(--muted);
    }
    .cda-status-ok{color:#4bd28f;}
    .cda-status-warn{color:#ffba5c;}
    .cda-status-bad{color:#ff8585;}
    pre{
      margin:.45rem 0 .7rem;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--line);
      padding:.6rem .7rem;
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.82rem;
      max-height:260px;
      overflow:auto;
      white-space:pre-wrap;
      color:var(--ink);
    }
    .cda-mini{
      font-size:.82rem;
      color:var(--muted);
      margin-top:.3rem;
    }
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="cda-wrap cda-header">
    <a href="/abe---flag/index.html" class="chip">← A.B.E. Home</a>
    <h1>CDA — Constitutional Divergence Analyzer</h1>
    <p class="tagline">
      Turn a specific statute, policy, or enforcement practice into structured divergence flags and a 0–1 score.
      CDA uses your selections plus the LAW corpus (USC/CFR/funding) to show where state practice drifts away from
      federal authority and rights.
    </p>
    <nav class="chip-row">
      <a class="chip" href="intake/index.html">Intake</a>
      <span class="chip chip-alt">CDA</span>
      <a class="chip" href="ciri/index.html">CIRI</a>
      <a class="chip" href="law/index.html">Law Corpus</a>
      <a class="chip" href="integration/index.html">Integration</a>
    </nav>
  </div>
</header>

<main class="abe-main">
  <div class="cda-wrap cda-grid">

    <!-- LEFT: inputs -->
    <section class="cda-card">
      <h2>Step 1 — Describe the statute or practice</h2>
      <p class="cda-sub">
        Start from an Intake artifact (traffic stop, CPS action, contract term, policy memo) or fill this out manually.
        CDA does <em>not</em> guess law for you — you stay in control of every flag.
      </p>

      <h3>1.1 · Context</h3>
      <div class="cda-row">
        <div>
          <label for="statute-name">Statute / policy / practice name</label>
          <input id="statute-name" type="text" placeholder="e.g., Iowa DPS traffic stop on non-commercial driver">
        </div>
      </div>
      <div class="cda-row">
        <div>
          <label for="jurisdiction">Jurisdiction</label>
          <input id="jurisdiction" type="text" placeholder="e.g., Iowa, County X, City Y, or Federal">
        </div>
        <div>
          <label for="level">Level</label>
          <select id="level">
            <option value="state" selected>State / local</option>
            <option value="federal">Federal</option>
          </select>
        </div>
        <div>
          <label for="population">Who is impacted?</label>
          <select id="population">
            <option value="non_commercial" selected>Non-commercial citizens</option>
            <option value="commercial">Commercial / DOT-regulated</option>
            <option value="mixed">Mixed or unclear</option>
          </select>
        </div>
      </div>

      <label for="citations">Citations (optional)</label>
      <input id="citations" type="text" placeholder="e.g., 49 CFR 390.3, Iowa Code 80.9, local ordinance…">

      <label for="funding">Related federal funding or programs (optional)</label>
      <input id="funding" type="text" placeholder="e.g., MCSAP, FMCSA, Highway Safety Grants, CPS block grants…">

      <h3>1.2 · Divergence flags</h3>
      <p class="cda-sub">
        Check every flag that applies. CDA weights them using <code>cda/model.json</code> and outputs a 0–1 divergence score.
      </p>

      <div class="cda-chips">
        <!-- scope / preemption -->
        <label class="cda-chip cda-chip-scope">
          <input type="checkbox" id="flag-scope_noncommercial_treated_as_commercial">
          <span>Scope: non-commercial treated as commercial</span>
        </label>
        <label class="cda-chip cda-chip-scope">
          <input type="checkbox" id="flag-ultra_vires_enforcement">
          <span>Ultra vires enforcement (beyond statute)</span>
        </label>
        <label class="cda-chip cda-chip-main">
          <input type="checkbox" id="flag-preemption_conflict">
          <span>Conflicts with federal commercial scope</span>
        </label>
        <label class="cda-chip cda-chip-main">
          <input type="checkbox" id="flag-preemption_field">
          <span>Field preemption (Congress already occupied)</span>
        </label>

        <!-- funding -->
        <label class="cda-chip cda-chip-fund">
          <input type="checkbox" id="flag-mcsap_off_mission">
          <span>MCSAP or FMCSA funds off-mission</span>
        </label>
        <label class="cda-chip cda-chip-fund">
          <input type="checkbox" id="flag-funding_conditions_ignored">
          <span>Funding conditions ignored</span>
        </label>
        <label class="cda-chip cda-chip-fund">
          <input type="checkbox" id="flag-funding_nontransparent">
          <span>Funding source non-transparent</span>
        </label>

        <!-- rights / process -->
        <label class="cda-chip cda-chip-rights">
          <input type="checkbox" id="flag-right_to_travel_burdened">
          <span>Right to travel burdened (non-commercial)</span>
        </label>
        <label class="cda-chip cda-chip-rights">
          <input type="checkbox" id="flag-due_process_defects">
          <span>Due process defects (notice / hearing / appeal)</span>
        </label>
        <label class="cda-chip cda-chip-rights">
          <input type="checkbox" id="flag-selective_application">
          <span>Selective / arbitrary application</span>
        </label>
      </div>

      <h3>1.3 · Notes (plain language)</h3>
      <textarea id="notes" placeholder="Explain what is actually happening. Example: DPS is stopping non-commercial drivers, treating them as CDL holders, using MCSAP funds, and jailing without warrant or magistrate."></textarea>

      <p class="cda-mini" id="intake-bridge-note">
        Intake bridge: looking for an Intake artifact in this browser…
      </p>

      <button id="btn-generate" class="btn-run">
        <span>⚖️ Generate CDA scenario & score</span>
      </button>
      <div id="cda-status" class="cda-status">Status: waiting to run…</div>
    </section>

    <!-- RIGHT: outputs -->
    <section class="cda-card">
      <h2>Step 2 — Review score & outputs</h2>

      <h3>2.1 · Divergence score</h3>
      <div id="cda-score-pill" class="cda-score-badge">
        Score (0–1): <span id="cda-score-value">—</span>
      </div>
      <p class="cda-mini">
        A score near <strong>0</strong> means low constitutional divergence.  
        A score near <strong>1</strong> means strong conflict with federal authority and rights.
      </p>

      <h3>2.2 · Structured JSON</h3>
      <pre id="cda-json">{}</pre>

      <h3>2.3 · Plain-language summary</h3>
      <pre id="cda-summary">Run CDA to generate a summary…</pre>

      <button id="btn-download" class="btn-download" disabled>
        ⬇ Download cda_cda-scenario.json
      </button>
      <p class="cda-mini" id="cda-hash-line">
        Audit hash: —  
        (SHA-256 of this CDA JSON, for chain-of-custody and tamper detection.)
      </p>
    </section>

  </div>
</main>

<footer class="abe-footer">
  <p>
    CC BY-NC 4.0 · DOI <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a> · Integrity only — never for sale.
  </p>
</footer>

<script src="cda/local.js"></script>
</body>
</html>
