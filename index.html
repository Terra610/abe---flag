<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>The American Butterfly Effect (A.B.E.) — System Hub</title>
<base href="/abe---flag/">
<style>
:root{--bg:#0b0d12;--panel:#141820;--panel2:#0f131a;--ink:#e6e6e6;--muted:#9fb3c8;--line:rgba(255,255,255,.08);--brand:#5ddfff;--accent:#fff750;--ok:#4bd28f;--warn:#ffa559}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{color:#80bfff;text-decoration:none}a:hover{text-decoration:underline}
header{padding:28px 20px;background:linear-gradient(90deg,#11151c,#1b1e25);border-bottom:1px solid var(--line)}
.wrap{max-width:1100px;margin:0 auto;padding:0 20px}
h1,h2,h3{margin:0 0 8px}
.sub{color:var(--muted)}
.badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.badges a,.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:.9rem}
.grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px}
.tile{background:var(--panel2);border:1px solid var(--line);border-radius:10px;padding:14px}
.kpi{display:flex;gap:14px;flex-wrap:wrap}
.kpi .tile{flex:1 1 220px}
.num{font-weight:700;font-size:1.25rem}
small{color:var(--muted);font-size:.85rem}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{border:1px solid var(--line);padding:10px 12px;text-align:left}
.table th{background:var(--panel2)}
.status{display:inline-block;padding:2px 10px;border-radius:999px;border:1px solid var(--line);font-size:.85rem}
.ok{color:var(--ok);border-color:rgba(75,210,143,.35)}
.warn{color:var(--warn);border-color:rgba(255,165,89,.35)}
footer{margin:40px 0 24px;text-align:center;color:var(--muted);font-size:.9rem}
@media (max-width:720px){.kpi .tile{flex:1 1 100%}}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>The American Butterfly Effect (A.B.E.)</h1>
    <div class="sub" id="version-line">Constitutional & economic restoration framework — public, auditable, non-commercial.</div>
    <div class="badges">
      <a href="https://doi.org/10.5281/zenodo.17586107">
        <img src="https://zenodo.org/badge/DOI/10.5281/zenodo.17586107.svg" alt="DOI" height="18"/>
      </a>
      <span class="chip">License: CC BY-NC 4.0</span>
      <a class="chip" href="doctrine/index.html">Doctrine Library</a>
      <a class="chip" href="system/index.html">System Map</a>
      <a class="chip" href="macro/index.html">Macro Model</a>
    </div>
  </div>
</header>

<main class="wrap" style="margin:24px auto 44px">
  <div class="card">
    <h2 style="color:var(--accent)">What A.B.E. Does</h2>
    <p>A.B.E. converts <em>constitutional alignment</em> into <em>measurable, auditable economics</em>:<br>
    <strong>CAE</strong> → <strong>CDI</strong> → <strong>CIRI</strong> → <strong>CIBS</strong> → <strong>CFF</strong> → <strong>CII</strong> → <strong>Integration</strong></p>
  </div>

  <div class="card">
    <h3>Live KPIs</h3>
    <div class="kpi">
      <div class="tile"><div>Modeled Recovery (CIRI)</div><div id="k-ciri" class="num">—</div><small>From <code>/ciri/inputs.csv</code></small></div>
      <div class="tile"><div>CIRI Index</div><div id="k-ciri-idx" class="num">—</div><small>1−e<sup>-R/K</sup></small></div>
      <div class="tile"><div>Public Allocation (CIBS)</div><div id="k-cibs" class="num">—</div><small>From <code>/cibs/auto_budget.csv</code></small></div>
      <div class="tile"><div>ROI per Case</div><div id="k-roi" class="num">—</div><small>Recovery ÷ cases avoided</small></div>
    </div>
  </div>

  <div class="grid">
    <div class="card"><h3>CAE — Constitutional Alignment Engine</h3><p>Parses law → flags misalignment.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="cae/index.html">cae/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-cae" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <div class="card"><h3>CDI — Constitutional Divergence Index</h3><p>0–1 divergence signal.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="cdi/index.html">cdi/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-cdi" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <div class="card"><h3>CIRI — Integrity ROI Engine</h3><p>Turns divergence into recovery $.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="ciri/index.html">ciri/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-ciri" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <div class="card"><h3>CIBS — Integrity Baseline Schema</h3><p>Allocates recovery pool.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="cibs/index.html">cibs/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-cibs" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <!-- CFF — NEW -->
    <div class="card">
      <h3>CFF — Constitutional Funding Forensics</h3>
      <p>Follows federal appropriation → state line-item spend. Calculates Overreach Index.</p>
      <table class="table"><tbody>
        <tr><th>UI</th><td><a href="cff/index.html">cff/index.html</a></td></tr>
        <tr><th>Schema</th><td id="s-cff" class="status warn">Checking…</td></tr>
        <tr><th>Demo Data</th><td><a href="cff/inputs.csv">inputs.csv</a></td></tr>
      </tbody></table>
    </div>

    <div class="card"><h3>CII — Community Investment Interface</h3><p>Auditable project portfolios.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="cii/index.html">cii/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-cii" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <div class="card"><h3>Integration Layer</h3><p>Receipts & attestations.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="integration/index.html">integration/index.html</a></td></tr>
      <tr><th>Schema</th><td id="s-integration" class="status warn">Checking…</td></tr>
    </tbody></table></div>

    <div class="card"><h3>System Map</h3><p>Chain-of-custody ledger.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="system/index.html">system/index.html</a></td></tr>
    </tbody></table></div>

    <div class="card"><h3>Macro — Cascade Model</h3><p>Top-down impact summary.</p><table class="table"><tbody>
      <tr><th>UI</th><td><a href="macro/index.html">macro/index.html</a></td></tr>
    </tbody></table></div>
  </div>

  <div class="card">
    <h3>Schema Status Summary</h3>
    <div class="grid" id="schema-grid"></div>
    <small>Green = present • Orange = missing/empty</small>
  </div>
</main>

<footer>
  CC BY-NC 4.0 · DOI <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a><br>
  <em>Integrity only — never for sale.</em>
</footer>

<script>
const money = n=>!isFinite(n)?'—':new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0}).format(n);
function setStatus(id,ok){const e=document.getElementById(id);if(e){e.textContent=ok?'Schema present':'Missing';e.classList.toggle('ok',ok);e.classList.toggle('warn',!ok);}}

(async()=>{
  // version
  try{const r=await fetch('system/map.json',{cache:'no-store'});if(r.ok){const j=await r.json();document.getElementById('version-line').textContent=`v\( {j.version||'—'} · updated \){j.updated||''}`;}}catch(_){}

  // KPIs
  try{const r=await fetch('cibs/auto_budget.csv',{cache:'no-store'});const t=await r.text();const tot=t.trim().split('\n').slice(1).reduce((s,l)=>s+Number(l.split(',')[1]||0),0);document.getElementById('k-cibs').textContent=money(tot);}catch(_){}
  try{const r=await fetch('ciri/inputs.csv',{cache:'no-store'});const t=await r.text();const [h,d]=t.trim().split('\n');const keys=h.split(',');const vals=d.split(',');const o=Object.fromEntries(keys.map((k,i)=>[k.trim(),Number(vals[i])||0]));
    const total = o.cases_avoided*o.avg_cost_per_case + o.jail_days_avoided*o.cost_per_jail_day + o.fees_canceled_total + o.policy_corrections*o.avg_enforcement_cost_savings +
                  o.households_restored*o.avg_monthly_market_spend*o.months_effective + o.households_restored*o.employment_probability*o.avg_monthly_wage*o.months_effective/12 +
                  o.expected_lawsuits*o.avg_payout*(o.litigation_multiplier||1) - o.transition_costs_one_time;
    const K=2_000_000_000; const ciri=1-Math.exp(-Math.max(0,total)/K); const roi=total/Math.max(1,o.cases_avoided);
    document.getElementById('k-ciri').textContent=money(total);
    document.getElementById('k-ciri-idx').textContent=ciri.toFixed(2);
    document.getElementById('k-roi').textContent=money(roi);
  }catch(_){}

  // schema checks (including CFF)
  const targets=[
    {key:'CAE',id:'s-cae',path:'cae/schema.json'},
    {key:'CDI',id:'s-cdi',path:'cdi/schema.json'},
    {key:'CIRI',id:'s-ciri',path:'ciri/schema.json'},
    {key:'CIBS',id:'s-cibs',path:'cibs/schema.json'},
    {key:'CFF',id:'s-cff',path:'cff/schema.json'},
    {key:'CII',id:'s-cii',path:'cii/schema.json'},
    {key:'Integration',id:'s-integration',path:'integration/schema.json'}
  ];
  for(const t of targets){
    try{const r=await fetch(t.path,{cache:'no-store'});const ok=r.ok&&(await r.text()).trim().length>0;setStatus(t.id,ok);}catch(_){setStatus(t.id,false);}
  }
  const grid=document.getElementById('schema-grid');
  if(grid){
    grid.innerHTML=targets.map(t=>`<div class="tile"><div style="display:flex;justify-content:space-between"><strong>\( {t.key}</strong><span id="sum- \){t.id}" class="status warn">Checking…</span></div><small><code>${t.path}</code></small></div>`).join('');
    targets.forEach(t=>{const e=document.getElementById(`sum-${t.id}`);const s=document.getElementById(t.id);if(e&&s){e.textContent=s.textContent;e.className=s.className;}});
  }
})();
</script>
</body>
</html>
