<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CIBS — Community Budget Schema | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="../abe-patch/assets/abe-patch.css"/>
  <style>
    .cibs-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.5rem 1rem 3rem;
    }
    .cibs-header h1{
      margin:0 0 .25rem;
      font-size:1.9rem;
    }
    .cibs-header .tagline{
      max-width:780px;
      color:var(--muted);
      font-size:.98rem;
    }
    .cibs-grid{
      display:grid;
      gap:1.1rem;
    }
    @media(min-width:900px){
      .cibs-grid{
        grid-template-columns:1.4fr 1.6fr;
      }
    }
    .cibs-card{
      background:var(--panel);
      border-radius:14px;
      border:1px solid var(--line);
      padding:1rem 1.1rem 1.2rem;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      min-height:0;
    }
    .cibs-card h2{
      margin:.1rem 0 .4rem;
      font-size:1.15rem;
    }
    .cibs-card h3{
      margin:.35rem 0 .3rem;
      font-size:1rem;
    }
    .cibs-sub{
      color:var(--muted);
      font-size:.9rem;
    }
    label{
      display:block;
      font-size:.86rem;
      color:var(--muted);
      margin:.55rem 0 .18rem;
    }
    input[type="number"]{
      width:100%;
      background:#050712;
      border-radius:9px;
      border:1px solid var(--line);
      padding:.45rem .6rem;
      color:var(--ink);
      font-size:.88rem;
    }
    .cibs-row{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
    }
    .cibs-row > div{
      flex:1 1 160px;
    }
    .cibs-mini{
      font-size:.82rem;
      color:var(--muted);
      margin-top:.3rem;
    }
    .cibs-status{
      margin-top:.6rem;
      font-size:.84rem;
      color:var(--muted);
    }
    .cibs-status-ok{color:#4bd28f;}
    .cibs-status-warn{color:#ffba5c;}
    .cibs-status-bad{color:#ff8585;}
    .cibs-cat-grid{
      display:grid;
      gap:.45rem;
      margin-top:.4rem;
    }
    @media(min-width:900px){
      .cibs-cat-grid{
        grid-template-columns:repeat(2,minmax(0,1fr));
      }
    }
    .cibs-cat{
      background:#050712;
      border-radius:10px;
      border:1px solid var(--line);
      padding:.45rem .55rem .5rem;
      font-size:.85rem;
    }
    .cibs-cat-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.4rem;
      margin-bottom:.2rem;
    }
    .cibs-cat-name{
      font-weight:600;
    }
    .cibs-cat-perc{
      width:72px;
    }
    .cibs-cat-amount{
      margin-top:.15rem;
      font-size:.88rem;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:.8rem;
      padding:.45rem 1.05rem;
      border-radius:999px;
      border:1px solid var(--accent);
      background:#050712;
      color:var(--ink);
      font-size:.9rem;
      cursor:pointer;
      gap:.4rem;
    }
    .btn:hover{
      box-shadow:0 0 0 1px rgba(93,223,255,.36),0 0 18px rgba(93,223,255,.25);
    }
    .btn-ghost{
      border-color:var(--line);
      margin-left:.3rem;
    }
    .btn-ghost:hover{
      box-shadow:none;
      background:#080b15;
    }
    .btn:disabled{
      opacity:.55;
      cursor:default;
      box-shadow:none;
    }
    pre{
      margin:.45rem 0 .7rem;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--line);
      padding:.6rem .7rem;
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.82rem;
      max-height:260px;
      overflow:auto;
      white-space:pre-wrap;
      color:var(--ink);
    }
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="cibs-wrap cibs-header">
    <a href="/abe---flag/index.html" class="chip">← A.B.E. Home</a>
    <h1>CIBS — Community Budget Schema</h1>
    <p class="tagline">
      Turn CIRI recovery (R<sub>T</sub>) into a simple, transparent budget for housing, clinics, food, mobility,
      workforce, and justice repair — ready for CII to turn into projects.
    </p>
    <nav class="chip-row">
      <a class="chip" href="../intake/index.html">Intake</a>
      <a class="chip" href="../cda/index.html">CDA</a>
      <a class="chip" href="../ciri/index.html">CIRI</a>
      <span class="chip chip-alt">CIBS</span>
      <a class="chip" href="../cii/index.html">CII</a>
      <a class="chip" href="../macro/index.html">Macro</a>
      <a class="chip" href="../integration/index.html">Integration</a>
    </nav>
  </div>
</header>

<main class="abe-main">
  <div class="cibs-wrap cibs-grid">

    <!-- LEFT: total + template -->
    <section class="cibs-card">
      <h2>Step 1 — Recovery pool & template</h2>
      <p class="cibs-sub">
        CIBS looks for your last CIRI scenario in this browser. You can override the total or tweak
        category percentages at any time. Percentages should add up to 100%.
      </p>

      <label for="cibs-total">Total recovery (R<sub>T</sub>) from CIRI (USD)</label>
      <input id="cibs-total" type="number" min="0" step="1" value="0">

      <p id="cibs-bridge" class="cibs-mini">
        CIRI bridge: looking for ABE_CIRI_SCENARIO_V2 in this browser…
      </p>

      <h3>1.1 · Category template</h3>
      <div class="cibs-row">
        <div>
          <label>Preset template</label>
          <select id="cibs-template">
            <option value="default" selected>Default · housing/health/food/mobility/work</option>
            <option value="housing_heavy">Housing-heavy</option>
            <option value="workforce_heavy">Workforce-heavy</option>
          </select>
        </div>
        <div>
          <label for="cibs-template-lock">Lock template totals</label>
          <input id="cibs-template-lock" type="checkbox" checked>
          <span class="cibs-mini">Keep sum at 100% when you tweak individual fields.</span>
        </div>
      </div>

      <div id="cibs-cats" class="cibs-cat-grid">
        <!-- categories injected by JS -->
      </div>

      <button id="cibs-recalc" class="btn">
        <span>⚖ Recalculate allocations</span>
      </button>
      <span id="cibs-status" class="cibs-status">Status: ready — using default template.</span>
    </section>

    <!-- RIGHT: outputs + receipts -->
    <section class="cibs-card">
      <h2>Step 2 — Budget & receipts</h2>

      <h3>2.1 · Budget preview</h3>
      <pre id="cibs-json">{}</pre>

      <h3>2.2 · Downloads</h3>
      <button id="cibs-download-csv" class="btn" disabled>
        ⬇ Download cibs_budget.csv
      </button>
      <button id="cibs-download-json" class="btn btn-ghost" disabled>
        ⬇ Download cibs_budget.json
      </button>

      <p id="cibs-hash" class="cibs-mini">
        Audit hash: —  
        (SHA-256 of this CIBS budget. Any tampering will change this value.)
      </p>

      <p class="cibs-mini">
        Next step: open <strong>CII</strong> to convert this budget into real project portfolios
        (housing units, clinic capacity, transit passes, child care slots, and more).
      </p>
    </section>

  </div>
</main>

<footer class="abe-footer">
  <p>
    CC BY-NC 4.0 · DOI <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a> · Integrity only — never for sale.
  </p>
</footer>

<script src="local.js"></script>
</body>
</html>
