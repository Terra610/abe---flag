<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CIRI ‚Äì Constitutional Integrity ROI Engine | A.B.E.</title>
  <style>
    :root{
      --bg:#0b0d12; --panel:#13161b; --ink:#e0e0e0; --muted:#9aa3ad;
      --edge:rgba(255,255,255,.08); --edge2:rgba(255,255,255,.12);
      --accent:#5ddfff; --accent2:#ffa559;
    }
    *{box-sizing:border-box}
    body{
      background:var(--bg);color:var(--ink);
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      line-height:1.65;margin:0;
    }

    header{
      background:linear-gradient(90deg,#11151c,#1b1e25);
      border-bottom:1px solid var(--edge);
      padding:2rem 1rem;
      text-align:center;
      position:relative;
    }
    .home-btn{
      position:absolute;left:1rem;top:1.2rem;
      background:var(--accent);color:#0b0d12;
      padding:.45rem .9rem;border-radius:8px;font-weight:700;
      text-decoration:none;font-size:.9rem;
      transition:all .2s ease-in-out;border:1px solid transparent;
    }
    .home-btn:hover{
      background:#82eaff;box-shadow:0 0 8px rgba(93,223,255,.7);
      transform:translateY(-2px);
    }
    h1{
      color:var(--accent2);font-size:1.8rem;
      margin:.1rem 0 .4rem;font-weight:800;
    }
    header p{margin:.25rem 0 0;color:var(--muted)}
    .top-actions{
      display:flex;gap:.6rem;flex-wrap:wrap;
      justify-content:center;margin:.9rem 0 0;
    }
    .btn,.badge{
      display:inline-block;text-decoration:none;font-weight:700;
      border-radius:8px;transition:all .18s ease-in-out;
    }
    .btn{
      background:var(--accent);color:#0b0d12;
      padding:.55rem 1rem;border:1px solid transparent;
    }
    .btn:hover{
      background:#82eaff;transform:translateY(-2px);
      box-shadow:0 0 10px rgba(93,223,255,.6);
    }
    .badge{
      color:var(--accent);border:1px solid var(--accent);
      padding:.45rem .7rem;font-size:.9rem;
    }
    .badge:hover{
      background:rgba(93,223,255,.08);transform:translateY(-2px);
    }

    main{max-width:1000px;margin:2rem auto 3.5rem;padding:0 1rem}
    section{
      background:rgba(255,255,255,.03);border:1px solid var(--edge);
      border-radius:12px;padding:1.2rem 1.4rem;margin-bottom:1.4rem;
      box-shadow:0 0 12px rgba(93,223,255,.05);
    }
    section:hover{box-shadow:0 0 16px rgba(93,223,255,.12)}
    h2{color:var(--accent2);font-size:1.2rem;margin:.2rem 0 .7rem}
    a{color:#80bfff} a:hover{text-decoration:underline}
    pre,code{
      background:rgba(255,255,255,.07);
      padding:.25rem .4rem;border-radius:6px;color:#e3e3e3;
    }

    /* CIRI live calculator styles */
    .ciri-box{
      background:#111;border:1px solid #222;
      border-radius:10px;padding:16px;margin:20px 0;
    }
    .ciri-kpis{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;margin:12px 0;
    }
    .ciri-kpi{
      background:#151922;border:1px solid #232a36;
      border-radius:10px;padding:12px;
    }
    .ciri-kpi .lbl{color:#9fb0c9;font-size:12px}
    .ciri-kpi .val{font:800 22px/1 system-ui;margin-top:4px}
    .ciri-small{font-size:12px;color:#9fb0c9}
    .ciri-grid{
      display:grid;grid-template-columns:1fr 1fr;gap:16px;
    }
    .ciri-grid>div{
      background:#151922;border:1px solid #232a36;
      border-radius:10px;padding:12px;
    }
    .ciri-table{width:100%;border-collapse:collapse}
    .ciri-table th,.ciri-table td{
      padding:6px;border-bottom:1px solid #232a36;text-align:left;
    }
    .ciri-err{color:#f99}
    canvas{max-width:100%}
    .btn-ghost{
      padding:6px 10px;border:1px solid #2a3344;border-radius:6px;
      background:#0d0f12;color:#eaeef7;cursor:pointer;font-size:.85rem;
    }
    .btn-ghost:hover{border-color:var(--accent);color:var(--accent)}
    @media (max-width:800px){.ciri-grid{grid-template-columns:1fr}}

    /* Data health banner (validator) */
    #data-health{
      border:1px solid #2a3344;border-radius:10px;
      padding:10px;background:#0e1218;
      margin:-.4rem 0 1rem;font-size:.9rem;
    }
    #data-health.ok{border-color:#245b3c;background:#0f1713}
    #data-health.warn{border-color:#66501f;background:#17140b}
    #data-health.err{border-color:#6b2a2a;background:#170f10}

    /* mode + source pill + drop zone */
    .mode-toggle{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px;font-size:.9rem}
    .mode-toggle label{display:flex;align-items:center;gap:4px;cursor:pointer}
    #upload-row{margin-top:8px}
    .source-pill{
      display:inline-flex;align-items:center;gap:6px;
      border-radius:999px;border:1px solid #2a3344;
      padding:4px 10px;font-size:.8rem;color:#9fb0c9;
      background:#0d1016;margin-bottom:8px;
    }
    .source-pill code{background:transparent;padding:0}
    .drop-zone{
      margin-top:8px;border:1px dashed #2a3344;border-radius:8px;
      padding:12px;text-align:center;font-size:.85rem;color:#9fb0c9;
    }
    .drop-zone.dragover{
      border-color:var(--accent);
      background:rgba(93,223,255,.06);color:var(--accent);
    }

    footer{
      margin:32px 0 24px;text-align:center;
      color:#8fa1b6;font-size:.85rem;
    }
  </style>
</head>
<body>
<header>
  <a href="/abe---flag/index.html" class="home-btn">‚Üê Return to Home</a>
  <h1>CIRI (Constitutional Integrity ROI Engine)</h1>
  <p>The A.B.E. model for quantifying the financial impact of constitutional compliance.</p>
  <div class="top-actions">
    <a class="btn" href="/abe---flag/doctrine/index.html">üìú Doctrine Library</a>
    <a class="badge" href="/abe---flag/cibs/index.html">üìä CIBS</a>
    <a class="badge" href="/abe---flag/system/index.html">üó∫ System Map</a>
    <a class="badge" href="/abe---flag/integration/index.html">üîó Integration</a>
  </div>
</header>

<main>
  <!-- Data health banner (validator writes here) -->
  <section id="data-health" aria-live="polite">
    Checking <code>inputs.csv</code>‚Ä¶
  </section>

  <section>
    <h2>üßÆ Run the CIRI Calculator</h2>
    <p>
      The <strong>CIRI</strong> engine lets anyone measure the
      <em>economic impact of constitutional compliance</em>
      for their own city or county ‚Äî using a single CSV.
    </p>
    <ol>
      <li>Download the example sheet: <a href="./inputs.csv">inputs.csv</a>.</li>
      <li>Replace the example numbers with your local data (keep the header row the same).</li>
      <li>
        Either:
        <ul>
          <li>Commit your updated <code>inputs.csv</code> (for a permanent public model), or</li>
          <li>Use the ‚ÄúUpload CSV‚Äù option below to test it locally without touching the repo.</li>
        </ul>
      </li>
    </ol>
    <p class="ciri-small">
      Browser math and CLI math are aligned. No server required. Upload mode never saves or uploads your file ‚Äî all computation is local in your browser.
    </p>
  </section>

  <!-- Live calculator -->
  <section>
    <h2>‚ö° Live CIRI Calculator</h2>
    <div class="ciri-box" id="ciri-app">
      <div class="mode-toggle">
        <label>
          <input type="radio" name="mode" value="repo" checked>
          Use example from repo (<code>./inputs.csv</code>)
        </label>
        <label>
          <input type="radio" name="mode" value="upload">
          Upload my own CSV (local only)
        </label>
      </div>

      <div class="source-pill">
        Source:
        <span id="src-label"><code>./inputs.csv</code> (built-in)</span>
      </div>

      <div id="upload-row" style="display:none">
        <input type="file" id="file-input" accept=".csv" class="btn-ghost">
        <div id="drop-zone" class="drop-zone">
          ‚¨á Drop your county‚Äôs CSV here or use the file picker above.
        </div>
        <span class="ciri-small">
          CSV must match the standard CIRI headers
          (<code>cases_avoided, avg_cost_per_case, jail_days_avoided, cost_per_jail_day, fees_canceled_total, policy_corrections, avg_enforcement_cost_savings, households_restored, avg_monthly_market_spend, months_effective, employment_probability, avg_monthly_wage, expected_lawsuits, avg_payout, litigation_multiplier, transition_costs_one_time</code>).
        </span>
      </div>

      <div class="ciri-kpis">
        <div class="ciri-kpi">
          <div class="lbl">Total Recovery (USD)</div>
          <div id="kpi-total" class="val">‚Äî</div>
        </div>
        <div class="ciri-kpi">
          <div class="lbl">CIRI ‚Ä¢ Risk Index</div>
          <div id="kpi-ciri" class="val">‚Äî</div>
        </div>
        <div class="ciri-kpi">
          <div class="lbl">CII ‚Ä¢ Integrity Index</div>
          <div id="kpi-cii" class="val">‚Äî</div>
        </div>
        <div class="ciri-kpi">
          <div class="lbl">ROI per Case Avoided</div>
          <div id="kpi-roi" class="val">‚Äî</div>
        </div>
      </div>

      <div class="ciri-grid">
        <div>
          <div style="font-weight:700;margin-bottom:8px">Inputs</div>
          <table id="ciri-inputs" class="ciri-table" aria-label="CIRI inputs table"></table>
          <div id="ciri-status" class="ciri-small" style="margin-top:8px">Loading inputs‚Ä¶</div>
        </div>
        <div>
          <div style="font-weight:700;margin-bottom:8px">Assumptions</div>
          <div class="ciri-small">
            Risk scaling K = <code id="lbl-k">$1,000,000,000</code><br>
            (Tuned for national / large-state scale. Adjust in code for smaller jurisdictions.)
          </div>
          <div id="ciri-breakdown" class="ciri-small" style="margin-top:10px"></div>
          <canvas id="ciri-chart" height="120" aria-label="Breakdown chart"></canvas>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="btn-download" class="btn-ghost">Download Your Custom Report (CSV)</button>
            <a class="btn-ghost" href="/abe---flag/cibs/index.html">Open CIBS (Budget)</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section>
    <h2>About CIRI</h2>
    <p>
      CIRI translates lawful governance into measurable economic outcomes. Each prevented violation reduces
      measurable fiscal waste. Proper implementation strengthens GDP, restores public trust, and lowers state dependency.
    </p>
    <ul>
      <li><a href="./inputs.csv">Download example input sheet</a></li>
    </ul>
  </section>

  <!-- A.B.E. Nav Dock + Live KPIs -->
  <section id="abe-navdock" class="ciri-box" aria-label="A.B.E. Navigator">
    <h3 style="margin:0 0 10px;color:#5ddfff">A.B.E. Navigator ¬∑ Live Links</h3>
    <div style="display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))">
      <div style="background:#151922;border:1px solid #232a36;border-radius:10px;padding:14px">
        <div style="font-weight:600;margin-bottom:8px">Doctrines</div>
        <ul class="ciri-small" style="list-style:none;padding:0;margin:0;line-height:1.8">
          <li><a href="/abe---flag/doctrine/ABE_CRRA_Rebuild.pdf">A.B.E. ¬∑ CRRA ¬∑ Rebuild Together (viewer)</a></li>
          <li><a href="/abe---flag/doctrine/constitutional-fidelity.html">Constitutional Fidelity (full text)</a></li>
          <li><a href="/abe---flag/doctrine/void-ab-initio.html">Void ab Initio (full text)</a></li>
        </ul>
      </div>

      <div style="background:#151922;border:1px solid #232a36;border-radius:10px;padding:14px">
        <div style="font-weight:600;margin-bottom:8px">Calculators & KPIs</div>
        <ul class="ciri-small" style="list-style:none;padding:0;margin:0;line-height:1.9">
          <li><a href="/abe---flag/ciri/">CIRI Calculator</a> ‚Äî <span id="dock-ciri-total" style="opacity:.85">loading‚Ä¶</span></li>
          <li><a href="/abe---flag/cibs/">CIBS Budget</a> ‚Äî <span id="dock-cibs-total" style="opacity:.85">loading‚Ä¶</span></li>
          <li><a href="/abe---flag/integration/">Integration KPIs</a></li>
        </ul>
      </div>

      <div style="background:#151922;border:1px solid #232a36;border-radius:10px;padding:14px">
        <div style="font-weight:600;margin-bottom:8px">Archive & License</div>
        <div class="ciri-small" style="line-height:1.7">
          DOI: <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a><br/>
          License: <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a><br/>
          Project: <a href="/abe---flag/">terra610.github.io/abe---flag</a>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- CIRI calculator script -->
<script>
(function(){
  const K = 1_000_000_000;

  function money(n){
    try{
      return n.toLocaleString(undefined,{
        style:"currency",currency:"USD",maximumFractionDigits:0
      });
    }catch(_){
      return "$"+Math.round(n||0).toLocaleString();
    }
  }
  function pct(x){ return (x*100).toFixed(1)+"%"; }

  const REPO_CANDIDATES = ["./inputs.csv","/abe---flag/ciri/inputs.csv"];

  function parseCSV(text){
    const lines = text.trim().split(/\\r?\\n/).filter(Boolean);
    if(!lines.length) return {head:[],row:[],obj:{}};
    const head = lines[0].split(",").map(s=>s.trim());
    const row  = (lines[1] || "").split(",").map(s=>s.trim());
    const obj = {};
    head.forEach((h,i)=>{ obj[h] = row[i]; });
    return {head,row,obj};
  }

  function num(x){
    const n = Number(String(x||"").replace(/[^0-9.\\-]/g,""));
    return isFinite(n)? n : 0;
  }

  function compute(d){
    const cases_avoided          = num(d.cases_avoided);
    const avg_cost_per_case      = num(d.avg_cost_per_case);
    const jail_days_avoided      = num(d.jail_days_avoided);
    const cost_per_jail_day      = num(d.cost_per_jail_day);
    const fees_canceled_total    = num(d.fees_canceled_total);
    const policy_corrections     = num(d.policy_corrections);
    const avg_enforcement_cost_savings = num(d.avg_enforcement_cost_savings);
    const households_restored    = num(d.households_restored);
    const avg_monthly_market_spend = num(d.avg_monthly_market_spend);
    const months_effective       = num(d.months_effective);
    const employment_probability = num(d.employment_probability);
    const avg_monthly_wage       = num(d.avg_monthly_wage);
    const expected_lawsuits      = num(d.expected_lawsuits);
    const avg_payout             = num(d.avg_payout);
    const litigation_multiplier  = num(d.litigation_multiplier || d.multiplier);
    const transition_costs       = num(d.transition_costs_one_time);

    const direct_case   = cases_avoided * avg_cost_per_case;
    const detention     = jail_days_avoided * cost_per_jail_day;
    const fees          = fees_canceled_total;
    const enforcement   = policy_corrections * avg_enforcement_cost_savings;
    const market_access = households_restored * avg_monthly_market_spend * months_effective;
    const employment    = cases_avoided * employment_probability * avg_monthly_wage * (months_effective/12);
    const litigation    = expected_lawsuits * avg_payout * litigation_multiplier;

    let total = direct_case + detention + fees + enforcement + market_access + employment + litigation - transition_costs;
    total = Math.max(0, total);

    const ciri = 1 - Math.exp(- total / Math.max(1,K));
    const cii  = 1 - ciri;
    const roi_per_case = cases_avoided>0 ? total / cases_avoided : 0;

    return {
      total, ciri, cii, roi_per_case,
      parts:{direct_case,detention,fees,enforcement,market_access,employment,litigation,transition_costs}
    };
  }

  function drawBars(canvas, values){
    const ctx = canvas.getContext("2d");
    const W = canvas.width, H = canvas.height;
    const max = Math.max(...values.map(v=>v.v), 1);
    ctx.clearRect(0,0,W,H);
    const n = values.length, bw = Math.floor(W/(n*2)), gap = bw;
    const base = H - 12;
    values.forEach((item,i)=>{
      const h = Math.round((item.v/max)*(H-24));
      ctx.fillStyle = "#e0e0e0";
      ctx.fillRect(10 + i*(bw+gap), base-h, bw, h);
      ctx.font = "11px system-ui";
      ctx.fillText(item.k, 10 + i*(bw+gap), H-2);
    });
  }

  function renderTable(head,row){
    const tbl = document.getElementById("ciri-inputs");
    if(!head.length){
      tbl.innerHTML = "<tbody><tr><td>No data</td></tr></tbody>";
      return;
    }
    let html = '<thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>';
    head.forEach((h,i)=>{
      html += `<tr><td>${h}</td><td>${row[i] ?? ""}</td></tr>`;
    });
    html += "</tbody>";
    tbl.innerHTML = html;
  }

  async function loadRepoCSV(){
    for(const url of REPO_CANDIDATES){
      try{
        const res = await fetch(url,{cache:"no-store"});
        if(res.ok){
          const text = await res.text();
          return {text, src:url};
        }
      }catch(_){}
    }
    return {text:null, src:null};
  }

  async function loadCibsTotal(){
    try{
      const res = await fetch("/abe---flag/cibs/auto_budget.csv",{cache:"no-store"});
      if(!res.ok) return null;
      const text = await res.text();
      const lines = text.trim().split(/\\r?\\n/);
      if(lines.length<2) return 0;
      const rows = lines.slice(1);
      let sum = 0;
      rows.forEach(line=>{
        const cells = line.split(",");
        const v = Number(cells[1]);
        if(isFinite(v)) sum += v;
      });
      return sum;
    }catch(_){
      return null;
    }
  }

  function applyResults(parsed, result, srcLabel){
    const status = document.getElementById("ciri-status");
    if(!parsed.head.length){
      status.innerHTML = '<span class="ciri-err">No data found in CSV</span>';
      return;
    }
    status.textContent = "Loaded from " + srcLabel;

    renderTable(parsed.head, parsed.row);

    document.getElementById("kpi-total").textContent = money(result.total);
    document.getElementById("kpi-ciri").textContent  = pct(result.ciri);
    document.getElementById("kpi-cii").textContent   = pct(result.cii);
    document.getElementById("kpi-roi").textContent   = money(result.roi_per_case);

    const brk = document.getElementById("ciri-breakdown");
    brk.innerHTML = `
      <div><strong>Breakdown</strong></div>
      <ul>
        <li>Direct case savings: <strong>${money(result.parts.direct_case)}</strong></li>
        <li>Detention savings: <strong>${money(result.parts.detention)}</strong></li>
        <li>Fees canceled: <strong>${money(result.parts.fees)}</strong></li>
        <li>Enforcement savings: <strong>${money(result.parts.enforcement)}</strong></li>
        <li>Market access (household spend): <strong>${money(result.parts.market_access)}</strong></li>
        <li>Employment & income restoration: <strong>${money(result.parts.employment)}</strong></li>
        <li>Lawsuits avoided: <strong>${money(result.parts.litigation)}</strong></li>
        <li>Transition costs (one-time): <strong>‚àí${money(result.parts.transition_costs)}</strong></li>
      </ul>
      <div class="ciri-small">Risk scaling K = ${money(K)} ‚Ä¢ CIRI = 1 ‚àí exp(‚àíTotal/K)</div>
    `;

    const bars = [
      {k:"Case", v:result.parts.direct_case},
      {k:"Det.", v:result.parts.detention},
      {k:"Fees", v:result.parts.fees},
      {k:"Enf.",  v:result.parts.enforcement},
      {k:"Mkt.", v:result.parts.market_access},
      {k:"Emp.", v:result.parts.employment},
      {k:"Law.", v:result.parts.litigation}
    ];
    drawBars(document.getElementById("ciri-chart"), bars);

    const dockCiri = document.getElementById("dock-ciri-total");
    if(dockCiri) dockCiri.textContent = money(result.total);

    // Download report wiring
    const btn = document.getElementById("btn-download");
    btn.onclick = ()=>{
      const now = new Date().toISOString();
      const lines = [
        ["Generated", now],
        ["Source", srcLabel],
        [],
        ["Metric","Value"],
        ["Total Recovery (USD)", result.total],
        ["CIRI (Risk Index)", result.ciri],
        ["CII (Integrity Index)", result.cii],
        ["ROI per Case Avoided", result.roi_per_case],
        ["Direct Case Savings", result.parts.direct_case],
        ["Detention Savings", result.parts.detention],
        ["Fees Canceled", result.parts.fees],
        ["Enforcement Savings", result.parts.enforcement],
        ["Market Access", result.parts.market_access],
        ["Employment Restoration", result.parts.employment],
        ["Lawsuits Avoided", result.parts.litigation],
        ["Transition Costs", result.parts.transition_costs],
        [],
        ["Input Field","CSV Value"],
        ...Object.entries(parsed.obj).map(([k,v])=>[k,v])
      ];
      const csv = lines.map(r=>r.join(",")).join("\\n");
      const blob = new Blob([csv],{type:"text/csv"});
      const url  = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "CIRI_report.csv";
      a.click();
      URL.revokeObjectURL(url);
    };
  }

  async function init(){
    const modeRadios = document.querySelectorAll('input[name="mode"]');
    const uploadRow  = document.getElementById("upload-row");
    const fileInput  = document.getElementById("file-input");
    const dropZone   = document.getElementById("drop-zone");
    const dockCibsEl = document.getElementById("dock-cibs-total");
    const srcLabelEl = document.getElementById("src-label");

    // Load CIBS total once (from repo)
    const cibsTotal = await loadCibsTotal();
    if(dockCibsEl) dockCibsEl.textContent = cibsTotal==null ? "‚Äî" : money(cibsTotal);

    async function runRepo(){
      const status = document.getElementById("ciri-status");
      status.textContent = "Loading from repo‚Ä¶";
      const {text, src} = await loadRepoCSV();
      if(!text){
        status.innerHTML = '<span class="ciri-err">Could not load inputs.csv from repo</span>';
        return;
      }
      const parsed = parseCSV(text);
      const result = compute(parsed.obj);
      srcLabelEl.textContent = (src || "./inputs.csv") + " (built-in)";
      applyResults(parsed, result, src || "repo inputs.csv");
    }

    async function runUploadFromText(text, name){
      const status = document.getElementById("ciri-status");
      status.textContent = "Reading uploaded CSV‚Ä¶";
      const parsed = parseCSV(text);
      const result = compute(parsed.obj);
      srcLabelEl.textContent = name ? `uploaded CSV: ${name}` : "uploaded CSV";
      applyResults(parsed, result, "uploaded CSV ("+(name||"file")+")");
    }

    async function runUpload(file){
      if(!file){
        document.getElementById("ciri-status").innerHTML = '<span class="ciri-err">No file selected</span>';
        return;
      }
      const text = await file.text();
      runUploadFromText(text, file.name);
    }

    // Default: repo mode
    await runRepo();

    modeRadios.forEach(r=>{
      r.addEventListener("change", async e=>{
        if(e.target.value === "upload"){
          uploadRow.style.display = "block";
          document.getElementById("ciri-status").textContent = "Upload a CSV or drop it into the box to recalculate.";
        }else{
          uploadRow.style.display = "none";
          fileInput.value = "";
          await runRepo();
        }
      });
    });

    fileInput.addEventListener("change", async e=>{
      const file = e.target.files[0];
      if(file) await runUpload(file);
    });

    // Drag & drop
    ["dragenter","dragover"].forEach(ev=>{
      dropZone.addEventListener(ev, e=>{
        e.preventDefault(); e.stopPropagation();
        dropZone.classList.add("dragover");
      });
    });
    ["dragleave","drop"].forEach(ev=>{
      dropZone.addEventListener(ev, e=>{
        e.preventDefault(); e.stopPropagation();
        dropZone.classList.remove("dragover");
      });
    });
    dropZone.addEventListener("drop", async e=>{
      const file = e.dataTransfer.files[0];
      if(file) await runUpload(file);
    });
  }

  init();
})();
</script>

<!-- validator (if present) -->
<script src="./validate_ciri.js"></script>

<footer>
  ¬© 2025 Terra Dawn Shouse ‚Äî American Butterfly Effect (A.B.E.)<br>
  Licensed under
  <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener" style="color:#5ddfff">
    Creative Commons Attribution‚ÄìNonCommercial 4.0 International (CC BY-NC 4.0)
  </a><br>
  <em>Integrity only ‚Äî never for sale.</em>
</footer>

</body>
  </html>
