<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AFFE ‚Äî A.B.E. Frontdoor & Forensic Extractor</title>
  <base href="/abe---flag/">
  <style>
    :root{
      --bg:#0b0d12;--panel:#141820;--panel2:#0f131a;
      --ink:#e6e6e6;--muted:#9fb3c8;
      --line:rgba(255,255,255,.08);--brand:#5ddfff;
      --accent:#ffa559;--ok:#4bd28f;--warn:#ffa559;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    }
    a{color:#80bfff;text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:24px 20px;
      background:linear-gradient(90deg,#11151c,#1b1e25);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:0 20px}
    h1{margin:0 0 6px;font-size:1.5rem}
    .sub{color:var(--muted);max-width:680px}
    .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--line);color:var(--muted);font-size:.9rem;
    }
    main{max-width:1100px;margin:24px auto 44px;padding:0 20px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{
      background:var(--panel);border:1px solid var(--line);
      border-radius:12px;padding:16px;
    }
    h2{margin:0 0 8px;font-size:1.1rem;color:var(--accent)}
    h3{margin:0 0 6px;font-size:1rem}
    .sm{font-size:.9rem;color:var(--muted)}
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 8px;border-radius:999px;
      border:1px solid var(--line);font-size:.8rem;color:var(--muted);
    }
    .pill strong{color:var(--ink)}

    /* Drop zone */
    .drop-wrap{margin-top:10px}
    .drop-zone{
      border:2px dashed rgba(93,223,255,.6);
      border-radius:12px;
      padding:22px 16px;
      background:rgba(15,19,26,.9);
      text-align:center;
      cursor:pointer;
      transition:border-color .18s,background .18s,transform .18s;
    }
    .drop-zone:hover{border-color:var(--brand);background:#141a24;transform:translateY(-1px)}
    .drop-zone.dragover{border-color:#fff750;background:#161d28}
    .drop-title{
      font-weight:600;margin-bottom:4px;
    }
    .drop-sub{font-size:.9rem;color:var(--muted)}
    .drop-sub code{font-size:.85rem}
    .ghost-icon{
      font-size:2.4rem;opacity:.75;margin-bottom:4px;
    }
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:.45rem .9rem;border-radius:9px;
      border:1px solid var(--line);background:#0f131a;
      color:var(--ink);font-size:.9rem;cursor:pointer;
      margin-top:8px;
    }
    .btn:hover{border-color:var(--brand)}
    .btn[disabled]{opacity:.5;cursor:not-allowed}

    /* File summary + routing */
    .file-meta{margin-top:10px;font-size:.9rem;color:var(--muted)}
    .file-meta ul{margin:4px 0 0;padding-left:18px}
    .tag{
      display:inline-block;margin-left:6px;margin-top:2px;
      padding:1px 6px;border-radius:999px;font-size:.75rem;
      border:1px solid var(--line);color:var(--muted);
    }
    .tag-funding{border-color:#5ddfff;color:#5ddfff}
    .tag-impact{border-color:#ffa559;color:#ffa559}
    .tag-unknown{border-color:#9fb3c8;color:#9fb3c8}

    .route-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin-top:10px}
    .route-box{
      background:var(--panel2,#0f131a);
      border:1px solid var(--line);
      border-radius:10px;padding:10px 12px;font-size:.9rem;
    }
    .route-box strong{display:block;margin-bottom:4px}

    .log{
      font-family:ui-monospace,Menlo,Consolas,monospace;
      font-size:.8rem;background:#0b0f16;
      border-radius:8px;border:1px solid var(--line);
      padding:10px;margin-top:8px;white-space:pre-wrap;
      max-height:180px;overflow:auto;
    }

    footer{
      margin:32px 0 20px;text-align:center;
      color:var(--muted);font-size:.9rem;
    }

    @media (max-width:720px){
      header{padding:20px 12px}
      main{padding:0 12px}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div>
      <a href="/abe---flag/index.html" class="chip">‚Üê Home</a>
      <h1>AFFE ‚Äî A.B.E. Frontdoor & Forensic Extractor</h1>
      <div class="sub">
        Drop your own documents into the A.B.E. engine ‚Äî funding tables, case exports, or policy PDFs ‚Äî
        and keep every byte locked on your device while the system prepares them for CFF, CIRI, and the rest of the chain.
      </div>
      <div class="badges">
        <span class="chip">Mode: Local-only ¬∑ No upload</span>
        <a class="chip" href="ciri/index.html">CIRI</a>
        <a class="chip" href="cff/index.html">CFF</a>
        <a class="chip" href="integration/index.html">Integration</a>
        <a class="chip" href="macro/index.html">Macro</a>
      </div>
    </div>
  </div>
</header>

<main>
  <!-- 1. What AFFE does -->
  <section class="card">
    <h2>What AFFE Does</h2>
    <p class="sm">
      AFFE is the intake valve for the American Butterfly Effect engine. It doesn‚Äôt phone home, doesn‚Äôt store,
      and doesn‚Äôt upload. It just helps you turn your own evidence into clean, A.B.E.-ready data for:
    </p>
    <ul class="sm">
      <li><strong>CFF</strong> ‚Äî tracing whether funding is <code>ON_MISSION</code>, <code>OFF_MISSION</code>, or <code>UNCLEAR</code>.</li>
      <li><strong>CIRI</strong> ‚Äî converting harm and misuse into recovery dollars and risk indices.</li>
      <li><strong>Macro</strong> ‚Äî scaling your scenario up to see national impact.</li>
    </ul>
  </section>

  <!-- 2. Upload / drag-and-drop -->
  <section class="card">
    <h2>Upload Your Evidence (local only)</h2>
    <div class="sm">
      Start with whatever you actually have in the real world:
      <ul>
        <li>CSV / Excel exports (funding tables, arrests, case lists).</li>
        <li>Agency PDFs (NOFOs, grant awards, budget justifications).</li>
        <li>Court / docket exports in tabular form.</li>
      </ul>
    </div>

    <div class="drop-wrap">
      <div id="drop-zone" class="drop-zone" tabindex="0">
        <div class="ghost-icon">üì•</div>
        <div class="drop-title">Drop your county‚Äôs data here and watch the recovery number wake up.</div>
        <div class="drop-sub">
          Supported: <code>.csv</code>, <code>.xlsx</code>, <code>.xls</code>, <code>.pdf</code><br/>
          <strong>All parsing happens in your browser. Nothing leaves your device.</strong>
        </div>
        <button id="btn-choose" class="btn" type="button">‚Ä¶or choose a file</button>
        <input id="file-input" type="file" multiple
               accept=".csv,.xlsx,.xls,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf"
               style="display:none">
      </div>
    </div>

    <div id="file-meta" class="file-meta" style="display:none"></div>

    <div id="routes" class="route-grid" style="display:none">
      <div class="route-box">
        <strong>CFF ¬∑ Funding Forensics</strong>
        <div class="sm">
          Use for: grant tables, budget lines, NOFO-aligned spend.
          <br/>Next step: export/reshape into <code>cff/inputs.csv</code>.
        </div>
      </div>
      <div class="route-box">
        <strong>CIRI ¬∑ Recovery & Risk</strong>
        <div class="sm">
          Use for: cases avoided, detention days, fees, enforcement cost, households impacted.
          <br/>Next step: reshape into <code>ciri/inputs.csv</code>, or manually enter values.
        </div>
      </div>
      <div class="route-box">
        <strong>Macro ¬∑ Scenario</strong>
        <div class="sm">
          Once CIRI is set, use Macro to scale your ‚Äúone community‚Äù into 100, 1,000, or 10,000.
          <br/>Next step: send <code>ABE_CIRI_SCENARIO_V2</code> into the cascade (coming next).
        </div>
      </div>
    </div>

    <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px">
      <button id="btn-export-scenario" class="btn" type="button" disabled>
        Download ABE_CIRI_SCENARIO_V2 (stub)
      </button>
      <button id="btn-clear" class="btn" type="button" disabled>Clear files</button>
    </div>

    <div id="log" class="log" aria-label="Local processing log" style="display:none"></div>
  </section>

  <!-- 3. How to choose what to upload -->
  <section class="card">
    <h2>What Should I Upload First?</h2>
    <div class="grid">
      <div>
        <h3>üëÆüèΩ Enforcement / Justice</h3>
        <p class="sm">
          Use: CSVs of stops, arrests, citations, jail days, or probation violations.
          <br/>Goal: quantify wrongful enforcement and detention to feed CIRI.
        </p>
      </div>
      <div>
        <h3>üí∏ Funding & Grants</h3>
        <p class="sm">
          Use: state budget lines, grant award tables, USAspending exports, Single Audit notes.
          <br/>Goal: detect OFF_MISSION use for CFF and turn it into recovery in CIRI.
        </p>
      </div>
      <div>
        <h3>üè† Human Impact</h3>
        <p class="sm">
          Use: counts of households displaced, licenses suspended, kids removed, jobs lost.
          <br/>Goal: convert harm back into employment, stability, and spending power.
        </p>
      </div>
    </div>
  </section>

  <!-- 4. Privacy & integrity -->
  <section class="card">
    <h2>Privacy & Chain-of-Custody</h2>
    <p class="sm">
      AFFE never sends your data anywhere. Files are read into memory in your browser, summarized for you,
      and then discarded when you refresh or hit ‚ÄúClear files.‚Äù
      When you‚Äôre ready to move into <strong>CFF</strong>, <strong>CIRI</strong>, or <strong>Macro</strong>,
      you decide what to keep as a CSV and what to delete.
    </p>
  </section>
</main>

<footer>
  A.B.E. ‚Äî American Butterfly Effect ¬∑ AFFE v1 (intake shell) ¬∑ CC BY-NC 4.0<br/>
  Integrity only ‚Äî never for sale.
</footer>

<script>
(function(){
  const dz    = document.getElementById('drop-zone');
  const fin   = document.getElementById('file-input');
  const btnCh = document.getElementById('btn-choose');
  const meta  = document.getElementById('file-meta');
  const routes= document.getElementById('routes');
  const logEl = document.getElementById('log');
  const btnScenario = document.getElementById('btn-export-scenario');
  const btnClear    = document.getElementById('btn-clear');

  let files = [];

  function log(msg){
    if(!logEl) return;
    logEl.style.display = 'block';
    const ts = new Date().toISOString();
    logEl.textContent += `[${ts}] ${msg}\n`;
    logEl.scrollTop = logEl.scrollHeight;
  }

  function classifyFile(f){
    const name = f.name.toLowerCase();
    const type = f.type || '';
    if(name.endsWith('.csv') || name.endsWith('.xls') || name.endsWith('.xlsx')){
      // crude heuristics: CFF vs CIRI-ish
      if(name.includes('grant') || name.includes('budget') || name.includes('mcsap') || name.includes('fund')){
        return 'funding';
      }
      if(name.includes('case') || name.includes('jail') || name.includes('detention') || name.includes('ciri')){
        return 'impact';
      }
      return 'unknown';
    }
    if(name.endsWith('.pdf')){
      return 'unknown';
    }
    return 'unknown';
  }

  function tagFor(kind){
    if(kind === 'funding') return '<span class="tag tag-funding">likely CFF input</span>';
    if(kind === 'impact')  return '<span class="tag tag-impact">likely CIRI input</span>';
    return '<span class="tag tag-unknown">needs manual review</span>';
  }

  function renderSummary(){
    if(!files.length){
      meta.style.display = 'none';
      routes.style.display = 'none';
      btnScenario.disabled = true;
      btnClear.disabled = true;
      logEl.style.display = 'none';
      logEl.textContent = '';
      return;
    }
    btnScenario.disabled = false; // still stub, but UI shows "ready"
    btnClear.disabled = false;

    const rows = files.map(f=>{
      const kind = classifyFile(f);
      const sizeKB = (f.size/1024).toFixed(1);
      return `<li>${f.name} ‚Äî ${sizeKB} KB${tagFor(kind)}</li>`;
    }).join('');

    meta.innerHTML = `
      <div><strong>Files staged for local analysis:</strong></div>
      <ul>${rows}</ul>
      <div class="sm" style="margin-top:4px">
        AFFE does not upload or save these files. They live only in your browser session until you clear or refresh.
      </div>
    `;
    meta.style.display = 'block';
    routes.style.display = 'grid';
  }

  function handleFiles(list){
    const incoming = Array.from(list || []);
    if(!incoming.length) return;
    log(`Received ${incoming.length} file(s) via ${event && event.type || 'input'}.`);
    files = files.concat(incoming);
    renderSummary();
  }

  // Drag & drop wiring
  ['dragenter','dragover'].forEach(ev=>{
    dz.addEventListener(ev, e=>{
      e.preventDefault();
      e.stopPropagation();
      dz.classList.add('dragover');
    });
  });
  ['dragleave','drop'].forEach(ev=>{
    dz.addEventListener(ev, e=>{
      e.preventDefault();
      e.stopPropagation();
      if(ev === 'drop'){
        const dt = e.dataTransfer;
        if(dt && dt.files) handleFiles(dt.files);
      }
      dz.classList.remove('dragover');
    });
  });
  dz.addEventListener('click', ()=> fin.click());
  btnCh.addEventListener('click', ()=> fin.click());
  dz.addEventListener('keydown', e=>{
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      fin.click();
    }
  });
  fin.addEventListener('change', e=>{
    handleFiles(e.target.files || []);
    fin.value = '';
  });

  // Stub: export scenario (no real wiring yet)
  btnScenario.addEventListener('click', ()=>{
    if(!files.length) return;
    const now = new Date().toISOString();
    const rows = [
      ['scenario_id','generated_at','file_count','note'],
      ['ABE_CIRI_SCENARIO_V2', now, String(files.length),
       'Stub scenario export from AFFE ‚Äî next step is to map into CFF/CIRI templates.']
    ];
    const csv = rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv],{type:'text/csv'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = 'ABE_CIRI_SCENARIO_V2_stub.csv';
    a.click();
    URL.revokeObjectURL(url);
    log('Exported stub ABE_CIRI_SCENARIO_V2 CSV.');
  });

  btnClear.addEventListener('click', ()=>{
    files = [];
    renderSummary();
    log('Cleared staged files.');
  });

  log('AFFE intake shell ready. Waiting for files‚Ä¶');
})();
</script>
</body>
      </html>
