<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Intake & AI Assistant | A.B.E.</title>

  <!-- GitHub Pages base -->
  <base href="/abe---flag/">

  <!-- Global dark theme patch -->
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css"/>

  <style>
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.4rem 1rem 3rem;
    }

    .header h1{
      margin:.2rem 0 .25rem;
      font-size:1.85rem;
      line-height:1.15;
    }
    .tagline{
      max-width:860px;
      color:var(--muted);
      margin:.2rem 0 1rem;
    }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
      margin: .75rem 0 1rem;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding:.45rem .75rem;
      border-radius:999px;
      border:1px solid var(--line);
      background:#0b0f19;
      color:var(--ink);
      text-decoration:none;
      font-size:.9rem;
      cursor:pointer;
      user-select:none;
    }
    .chip:hover{ border-color: rgba(93,223,255,.55); }
    .chip.alt{
      border-color: rgba(93,223,255,.35);
      box-shadow:0 0 0 1px rgba(93,223,255,.15) inset;
    }
    .chip.danger{
      border-color: rgba(255,133,133,.35);
    }

    .grid{
      display:grid;
      gap:1rem;
    }
    @media(min-width:980px){
      .grid{
        grid-template-columns: 1.05fr 1.15fr;
      }
    }

    .card{
      background:#10131c;
      border:1px solid var(--line);
      border-radius:16px;
      padding:1rem 1rem 1.05rem;
      box-shadow:0 18px 40px rgba(0,0,0,.4);
      min-height:0;
    }
    .card h2{
      margin:.1rem 0 .35rem;
      font-size:1.05rem;
    }
    .sub{
      color:var(--muted);
      font-size:.9rem;
      margin:.1rem 0 .75rem;
    }

    .filebox{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
      align-items:flex-start;
      padding:.65rem .75rem;
      border:1px solid var(--line);
      border-radius:14px;
      background:#0b0f19;
      box-shadow:0 18px 40px rgba(0,0,0,.35);
      margin: .5rem 0 1rem;
    }
    .filebox label{
      color:var(--muted);
      font-size:.9rem;
      margin-right:.25rem;
    }
    input[type="file"]{
      color:var(--ink);
      max-width:100%;
    }

    #fileList{
      width:100%;
      margin-top:.35rem;
      color:var(--muted);
      font-size:.9rem;
    }
    #fileList ul{ margin:.35rem 0 0; padding-left:1.2rem; }
    #fileList li{ margin:.15rem 0; }

    .kv{
      display:grid;
      grid-template-columns: 170px 1fr;
      gap:.35rem .75rem;
      padding:.7rem .75rem;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:#050712;
    }
    @media(max-width:560px){
      .kv{ grid-template-columns: 1fr; }
    }
    .k{ color:var(--muted); font-size:.88rem; }
    .v{ color:var(--ink); font-size:.92rem; overflow-wrap:anywhere; }

    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.18rem .55rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      font-size:.78rem;
      letter-spacing:.02em;
      width:fit-content;
      margin-right:.35rem;
      margin-bottom:.35rem;
    }
    .pill.ok{ border-color: rgba(75,210,143,.45); color:#a9f3d1; }
    .pill.warn{ border-color: rgba(255,186,92,.5); color:#ffe1b3; }
    .pill.fail{ border-color: rgba(255,133,133,.5); color:#ffd0d0; }
    .pill.note{ border-color: rgba(93,223,255,.35); color:#c7f4ff; }

    pre.preview{
      margin:0;
      padding:.75rem .8rem;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background:#050712;
      color:var(--ink);
      overflow:auto;
      max-height:360px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:.82rem;
      white-space:pre-wrap;
      word-break:break-word;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
      margin:.6rem 0 0;
    }

    .miniBtn{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding:.45rem .7rem;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:#0b0f19;
      color:var(--ink);
      cursor:pointer;
      font-size:.9rem;
    }
    .miniBtn:hover{ border-color: rgba(93,223,255,.55); }

    .hint{
      margin-top:.65rem;
      color:var(--muted);
      font-size:.9rem;
    }

    .warnBox{
      margin-top:.75rem;
      padding:.7rem .75rem;
      border-radius:14px;
      border:1px solid rgba(255,186,92,.28);
      background: rgba(255,186,92,.06);
      color: var(--ink);
    }

    .okBox{
      margin-top:.75rem;
      padding:.7rem .75rem;
      border-radius:14px;
      border:1px solid rgba(75,210,143,.28);
      background: rgba(75,210,143,.06);
      color: var(--ink);
    }

    .footerNote{
      margin-top:1rem;
      color:var(--muted);
      font-size:.9rem;
    }
    .footerNote a{
      color:var(--accent);
      text-decoration:none;
    }
    .footerNote a:hover{ text-decoration:underline; }
  </style>
</head>

<body class="abe-page">
  <header class="abe-header">
    <div class="wrap header">
      <a class="chip" href="index.html">← A.B.E. Home</a>
      <h1>Intake & Assistant</h1>
      <p class="tagline">
        Upload documents locally (tickets, policies, reports, contracts). Nothing leaves your device.
        This page helps you understand what you uploaded and what the engine will do next.
      </p>

      <div class="toolbar" role="toolbar" aria-label="Intake controls">
        <button class="chip" id="btnHome" type="button">Home</button>
        <button class="chip" id="btnStart" type="button">Start</button>
        <button class="chip alt" id="btnOpenIntegration" type="button">Go to Integration / Run</button>
        <button class="chip danger" id="btnClear" type="button">Clear Local Intake</button>
      </div>

      <div class="filebox">
        <label for="fileInput"><strong>Upload files (local-only):</strong></label>
        <input id="fileInput" type="file" multiple />
        <div id="fileList"></div>
      </div>
    </div>
  </header>

  <main class="abe-main">
    <div class="wrap">
      <div class="grid">

        <!-- LEFT: Intake snapshot -->
        <section class="card">
          <h2>What you uploaded</h2>
          <p class="sub">
            This is a simple snapshot of your intake. The engine can run with uploads, or with a safe default scenario.
          </p>

          <div class="kv" style="margin-bottom:.75rem;">
            <div class="k">Storage</div>
            <div class="v"><span class="pill note">Local-only</span> Stored in your browser’s local storage (not a server).</div>

            <div class="k">Files found</div>
            <div class="v" id="intakeCount">0</div>

            <div class="k">Last updated</div>
            <div class="v" id="intakeUpdated">—</div>

            <div class="k">Next step</div>
            <div class="v">
              <span class="pill ok">Run</span> Open Integration and click <strong>Run Engine</strong>.
            </div>
          </div>

          <div id="intakeNotice" class="warnBox" style="display:none;"></div>
          <div id="intakeOk" class="okBox" style="display:none;"></div>

          <div class="row">
            <button class="miniBtn" id="btnSaveToScenario" type="button">Save Intake into Scenario</button>
            <button class="miniBtn" id="btnDownloadIntake" type="button">Download intake_artifact.json</button>
          </div>

          <p class="hint">
            <strong>Note:</strong> This assistant does not “judge people.” It only helps structure documents and explain what the engine is doing.
          </p>

          <p class="footerNote">
            Want the proof layer? Go to <a href="integration/index.html">Integration / Audit</a>.
          </p>
        </section>

        <!-- RIGHT: Assistant panel -->
        <section class="card">
          <h2>Assistant (local-only)</h2>
          <p class="sub">
            Plain-English guidance: what your files likely are, what modules will care, and what to do next.
          </p>

          <div style="margin-bottom:.6rem;">
            <span class="pill note">No API</span>
            <span class="pill note">No logins</span>
            <span class="pill note">No tracking</span>
            <span class="pill ok">Deterministic</span>
          </div>

          <pre id="assistantPreview" class="preview">Upload files to see assistant guidance.</pre>

          <div class="row">
            <button class="miniBtn" id="btnRefreshAssistant" type="button">Refresh Assistant</button>
            <button class="miniBtn" id="btnCopyAssistant" type="button">Copy Guidance</button>
          </div>

          <p class="footerNote">
            Tip: if you don’t have documents yet, you can still run a safe default scenario in Integration.
          </p>
        </section>

      </div>
    </div>
  </main>

  <footer class="abe-footer">
    <p>
      A.B.E. — Intake · CC BY-NC 4.0 · Local-only (no tracking).
    </p>
  </footer>

  <script type="module" src="intake/assistant.js"></script>
</body>
</html>
