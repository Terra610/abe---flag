<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Intake — Document + OCR Bridge | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css"/>
  <style>
    :root{
      --bg:#05070d;--panel:#111522;--panel2:#0b0f19;
      --ink:#e8edf7;--muted:#9ba5bb;--accent:#5ddfff;
      --line:rgba(255,255,255,.08);--ok:#32d88f;--warn:#ffba5c;--bad:#ff6b6b;
    }
    body{background:var(--bg);color:var(--ink);margin:0;font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1100px;margin:0 auto;padding:1.5rem 1rem 3rem}
    .row{display:flex;flex-wrap:wrap;gap:1rem;align-items:center}
    .stack{display:flex;flex-direction:column;gap:.5rem}
    .pill{display:inline-flex;align-items:center;gap:.25rem;padding:.15rem .6rem;border-radius:999px;
          font-size:.8rem;border:1px solid var(--line);color:var(--muted)}
    .pill-ok{border-color:var(--ok);color:var(--ok)}
    .pill-warn{border-color:var(--warn);color:var(--warn)}
    .pill-bad{border-color:var(--bad);color:var(--bad)}
    .field-label{font-size:.85rem;color:var(--muted)}
    input[type="file"]{font-size:.9rem}
    select,textarea,input[type="text"]{
      background:var(--panel2);border-radius:8px;border:1px solid var(--line);
      color:var(--ink);padding:.45rem .55rem;font-size:.9rem
    }
    textarea{width:100%;min-height:180px;resize:vertical}
    .targets label{margin-right:.75rem;font-size:.86rem}
    .mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;font-size:.85rem}
    #status{font-size:.86rem;color:var(--muted);margin-top:.35rem;white-space:pre-wrap}
    #extracted-preview{background:var(--panel2);border-radius:8px;border:1px solid var(--line);
      padding:.5rem .6rem;font-size:.85rem;max-height:200px;overflow:auto}
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="wrap">
    <a class="chip" href="/abe---flag/index.html">← A.B.E. Home</a>
    <h1>Intake — Document + OCR Bridge</h1>
    <p class="tagline">
      Front door for real people: upload a ticket, CPS letter, loan contract, or memo — Intake turns it into
      clean text and an <code>intake_artifact.json</code> that CIRI, CDA, CFF, and CCRI can use.
      Everything runs locally in your browser.
    </p>
  </div>
</header>

<main class="abe-main">
  <div class="wrap">

    <!-- 1. Upload + doc type -->
    <section class="card">
      <h2>1. Upload your document</h2>
      <div class="stack">
        <div class="row">
          <div class="stack" style="flex:2">
            <label class="field-label">File (image, PDF, or text)</label>
            <input type="file" id="file-input" accept=".pdf,image/*,.txt,.md,.rtf"/>
          </div>
          <div class="stack" style="min-width:220px">
            <label class="field-label">Document type</label>
            <select id="doc-type">
              <option value="traffic_ticket">Traffic / citation ticket</option>
              <option value="cps_case">CPS / child welfare</option>
              <option value="loan_contract">Loan / credit contract</option>
              <option value="policy_memo">Policy / memo / directive</option>
              <option value="generic_case_text">Generic case description</option>
            </select>
          </div>
        </div>

        <div class="row targets">
          <span class="field-label">Which engines should this feed?</span>
          <label><input type="checkbox" id="target-ciri" checked> CIRI</label>
          <label><input type="checkbox" id="target-cda" checked> CDA</label>
          <label><input type="checkbox" id="target-cff"> CFF</label>
          <label><input type="checkbox" id="target-ccri"> CCRI</label>
        </div>

        <div class="row">
          <button class="btn" id="btn-ocr">Run OCR / Extract Text</button>
          <span id="ocr-status" class="pill">waiting for file…</span>
        </div>
        <div id="status" class="mono"></div>
      </div>
    </section>

    <!-- 2. Normalized text -->
    <section class="card">
      <h2>2. Review and edit the text</h2>
      <p class="small-note">
        Intake will auto-fill this from your document. You can edit it before generating the artifact.
        This text is what downstream engines “see.”
      </p>
      <textarea id="normalized-text" placeholder="When you run OCR, the cleaned text will appear here…"></textarea>
    </section>

    <!-- 3. Extracted field preview -->
    <section class="card">
      <h2>3. Quick extracted-field preview</h2>
      <p class="small-note">
        This is a human-readable preview of the structured data Intake will embed into
        <code>intake_artifact.json</code>. Engines like CDA, CFF, and CCRI can use this to auto-build scenarios later.
      </p>
      <div id="extracted-preview" class="mono small-note">
        No artifact yet. Run OCR, then click “Generate A.B.E. Artifact”.
      </div>
    </section>

    <!-- 4. Generate artifact -->
    <section class="card">
      <h2>4. Generate A.B.E. artifact</h2>
      <p class="small-note">
        This will create a single <code>intake_artifact.json</code> file containing:
        hashed original file, normalized text, extracted fields, targets, and hashes for any helper files
        (e.g., a CIRI-ready CSV row). Everything is local — you decide what to share.
      </p>
      <div class="row">
        <button class="btn" id="btn-generate-artifact">Generate A.B.E. Artifact</button>
        <button class="btn btn-ghost" id="btn-download-ciri" disabled>Download CIRI CSV (from this doc)</button>
        <span id="artifact-status" class="pill pill-warn">no artifact yet</span>
      </div>
    </section>

  </div>
</main>

<footer class="abe-footer">
  <p>
    A.B.E. Intake · CC BY-NC 4.0 · Integrity only — never for sale.
  </p>
</footer>

<!-- OCR + PDF libs (browser-only, no tracking) -->
<script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="intake.js"></script>
</body>
</html>
