<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Intake ‚Äî Document & OCR Bridge | A.B.E.</title>
  <base href="/abe---flag/">
  <link rel="stylesheet" href="abe-patch/assets/abe-patch.css">
  <style>
    :root{
      --abe-bg:#05060b;
      --abe-panel:#10131c;
      --abe-panel-soft:#161a25;
      --abe-ink:#edf2ff;
      --abe-muted:#9fb3c8;
      --abe-accent:#5ddfff;
      --abe-pop:#fff750;
      --abe-border:rgba(255,255,255,.08);
    }
    body.abe-page{
      background:radial-gradient(circle at top,#111827 0,#05060b 55%,#020309 100%);
      color:var(--abe-ink);
    }
    .intake-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:1.5rem 1rem 3rem;
    }
    .intake-header h1{
      margin:0 0 .25rem;
      font-size:1.9rem;
    }
    .intake-header .tagline{
      max-width:700px;
      color:var(--abe-muted);
      font-size:.98rem;
    }
    .intake-grid{
      display:grid;
      gap:1.25rem;
    }
    @media(min-width:900px){
      .intake-grid{
        grid-template-columns:3fr 2fr;
      }
    }
    .card-intake{
      background:linear-gradient(135deg,var(--abe-panel),#0b101a);
      border-radius:14px;
      border:1px solid var(--abe-border);
      padding:1rem 1.1rem 1.25rem;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
    }
    .card-intake h2{
      margin:.1rem 0 .4rem;
      font-size:1.15rem;
    }
    .card-intake h3{
      margin:.2rem 0 .4rem;
      font-size:1rem;
    }
    .sub{
      color:var(--abe-muted);
      font-size:.9rem;
    }
    label{
      display:block;
      font-size:.9rem;
      color:var(--abe-muted);
      margin:.75rem 0 .25rem;
    }
    input[type="file"]{
      display:none;
    }
    .file-label{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.45rem .9rem;
      border-radius:999px;
      border:1px solid var(--abe-pop);
      background:transparent;
      color:var(--abe-ink);
      font-size:.9rem;
      cursor:pointer;
      gap:.45rem;
    }
    .file-label span{
      opacity:.9;
    }
    .file-name{
      display:inline-block;
      margin-left:.4rem;
      font-size:.85rem;
      color:var(--abe-muted);
      max-width:260px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      vertical-align:middle;
    }
    textarea{
      width:100%;
      min-height:120px;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--abe-border);
      padding:.6rem .7rem;
      color:var(--abe-ink);
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.85rem;
      resize:vertical;
    }
    select{
      width:100%;
      background:#050712;
      border-radius:999px;
      border:1px solid var(--abe-border);
      color:var(--abe-ink);
      padding:.4rem .7rem;
      font-size:.9rem;
    }
    .targets{
      margin-top:.4rem;
      font-size:.88rem;
      color:var(--abe-muted);
    }
    .targets label{
      display:flex;
      align-items:center;
      gap:.35rem;
      margin:.15rem 0;
    }
    .targets input[type="checkbox"]{
      width:15px;
      height:15px;
    }
    .btn-run{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:.8rem;
      padding:.45rem 1.05rem;
      border-radius:999px;
      border:1px solid var(--abe-pop);
      background:transparent;
      color:var(--abe-ink);
      font-size:.9rem;
      cursor:pointer;
      gap:.4rem;
      box-shadow:0 0 0 1px rgba(0,0,0,.5);
    }
    .btn-run:hover{
      box-shadow:0 0 0 1px rgba(255,247,80,.4),0 0 18px rgba(255,247,80,.25);
    }
    .status-line{
      margin-top:.6rem;
      font-size:.85rem;
      color:var(--abe-muted);
    }
    .status-ok{color:#4bd28f;}
    .status-warn{color:#ffba5c;}
    .status-err{color:#ff8585;}
    pre{
      margin:.4rem 0 .7rem;
      background:#050712;
      border-radius:10px;
      border:1px solid var(--abe-border);
      padding:.6rem .7rem;
      font-family:ui-monospace,SFMono-Regular,Consolas,monospace;
      font-size:.82rem;
      color:var(--abe-ink);
      max-height:260px;
      overflow:auto;
      white-space:pre-wrap;
    }
    .small-note{
      font-size:.82rem;
      color:var(--abe-muted);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      padding:.1rem .55rem;
      border-radius:999px;
      border:1px solid var(--abe-border);
      font-size:.78rem;
      color:var(--abe-muted);
      gap:.25rem;
    }
    .pill-local{
      border-color:#4bd28f;
      color:#4bd28f;
    }
    .download-btn{
      margin-top:.5rem;
      padding:.35rem .8rem;
      border-radius:999px;
      border:1px solid var(--abe-border);
      background:#050712;
      color:var(--abe-ink);
      font-size:.85rem;
      cursor:pointer;
    }
    .download-btn:disabled{
      opacity:.5;
      cursor:default;
    }
  </style>
</head>
<body class="abe-page">

<header class="abe-header">
  <div class="intake-wrap intake-header">
    <a href="/abe---flag/index.html" class="chip">‚Üê A.B.E. Home</a>
    <h1>Intake ‚Äî Document & OCR Bridge</h1>
    <p class="tagline">
      Upload a ticket, CPS letter, policy memo, or contract and let A.B.E. turn it into
      structured data for CIRI, CDA, CFF, and CCRI ‚Äî all in your browser, never on a server.
    </p>
  </div>
</header>

<main class="abe-main">
  <div class="intake-wrap intake-grid">

    <!-- LEFT: Steps 1‚Äì2 -->
    <section class="card-intake">
      <h2>Step 1 ‚Äî Tell Intake what you‚Äôre uploading</h2>

      <h3>1.1 ¬∑ Select one or more files</h3>
      <label class="file-label">
        <span>üìé Choose files</span>
        <input id="file-input" type="file" multiple>
      </label>
      <span id="file-name" class="file-name">No file chosen</span>
      <p class="small-note">
        You can upload ticket photos, scanned letters, PDFs, or simple text files.
        For multi-page docs, choose one file per page ‚Äî Intake will merge them.
      </p>

      <h3>1.2 ¬∑ Or paste plain text</h3>
      <textarea id="text-input" placeholder="Optional: paste the text of your ticket, CPS letter, contract, or policy memo here. If both files and text are provided, Intake will combine them."></textarea>
      <p class="small-note">
        Use this if your document is already text (email copy/paste, online docket, etc.).
      </p>

      <h3>1.3 ¬∑ What kind of document is this?</h3>
      <select id="doc-type">
        <option value="traffic_ticket">Traffic / citation ticket</option>
        <option value="cps_case">CPS / child welfare documents</option>
        <option value="policy_memo" selected>Policy / memo / directive</option>
        <option value="loan_contract">Loan / finance contract</option>
        <option value="generic_case_text">Other / freeform case text</option>
      </select>

      <div class="targets">
        <div>Send this intake to:</div>
        <label><input id="target-ciri" type="checkbox" checked> CIRI (economic recovery)</label>
        <label><input id="target-cda" type="checkbox"> CDA (divergence flags)</label>
        <label><input id="target-cff" type="checkbox"> CFF (funding forensics)</label>
        <label><input id="target-ccri" type="checkbox"> CCRI (credit risk integrity)</label>
      </div>

      <button id="run-intake" class="btn-run">
        <span>‚ö° Run Intake & OCR</span>
      </button>
      <span id="status" class="status-line">Status: waiting to run‚Ä¶</span>

      <p class="small-note" style="margin-top:.6rem">
        <span class="pill pill-local">Local-only</span>
        &nbsp;Files and OCR never leave this browser tab. You can close it at any time and keep your downloads.
      </p>
    </section>

    <!-- RIGHT: Step 2 + downloads -->
    <section class="card-intake">
      <h2>Step 2 ‚Äî Review text & extracted fields</h2>

      <h3>2.1 ¬∑ Normalized text (what Intake sees)</h3>
      <pre id="norm-text">Text will appear here after Intake runs‚Ä¶</pre>

      <h3>2.2 ¬∑ Extracted fields</h3>
      <pre id="fields-json">{}</pre>

      <h3>2.3 ¬∑ Download intake artifact</h3>
      <button id="download-artifact" class="download-btn" disabled>
        ‚¨á Download intake_artifact.json
      </button>
      <p class="small-note">
        This JSON file can be attached to motions, research memos, or uploaded again later.
        Integration will hash it and include it in the SHA-256 audit trail.
      </p>
    </section>

  </div>
</main>

<footer class="abe-footer">
  <p>
    CC BY-NC 4.0 ¬∑ DOI <a href="https://doi.org/10.5281/zenodo.17586107">10.5281/zenodo.17586107</a> ¬∑ Integrity only ‚Äî never for sale.
  </p>
</footer>

<script src="intake/intake.js"></script>
<script>
  // tiny helper: show chosen file names
  (function(){
    const fileInput = document.getElementById('file-input');
    const nameEl = document.getElementById('file-name');
    if(!fileInput || !nameEl) return;
    fileInput.addEventListener('change',()=>{
      if(!fileInput.files || !fileInput.files.length){
        nameEl.textContent = 'No file chosen';
        return;
      }
      const names = Array.from(fileInput.files).map(f=>f.name);
      nameEl.textContent = names.join(', ');
    });
  })();
</script>
</body>
</html>
